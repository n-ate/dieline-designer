<!DOCTYPE html>
<html>
    <head>
        <title>Demo</title>
        <style type="text/css">
            body {
                max-width: 1450px;
                margin: 2em auto 0;
            }
            main {
            }
            aside {
            }
            /* aside > svg {
                widows: 100%;
            } */
            .flex-form {
                display: flex;
                flex-wrap: wrap;
            }
            .flex-form,
            .flex-form * {
                font-size: 20px;
                color: purple;
            }
            .flex-form .group,
            .flex-form .field {
                box-sizing: border-box;
            }
            .flex-form .group {
                display: flex;
                flex-direction: column;
            }
            .flex-form > :nth-child(4n + 0) {
                border: solid 1px rgb(168, 168, 168);
                background: rgb(226, 226, 226);
            }
            .flex-form > :nth-child(4n + 1) {
                border: solid 1px rgb(129, 129, 129);
                background: rgb(209, 209, 209);
            }
            .flex-form > :nth-child(4n + 2) {
                border: solid 1px rgb(220, 202, 250);
                background: rgb(244, 236, 255);
            }
            .flex-form > :nth-child(4n + 3) {
                border: solid 1px rgb(208, 180, 252);
                background: rgb(232, 215, 252);
            }
            .flex-form .field {
                position: relative;
                min-width: 18em;
                max-width: 30em;
                padding: 0.3em 1em;
            }
            .flex-form .group .group .field {
                min-width: 9em;
                max-width: 15em;
                padding: 0.3em 1em;
            }
            .flex-form > .group,
            .flex-form > .field {
                flex-grow: 1;
                flex-basis: 15em;
            }
            .flex-form > .group > .group {
                flex-grow: 0.5;
                flex-basis: 7.5em;
            }
            .flex-form .field label {
            }
            .flex-form .field em {
                width: 5.7em;
                padding: 0 0.4em;
                float: right;
                text-align: right;
            }
            .flex-form .field input:not([type="radio"]) {
                width: 5.7em;
                padding: 0 0.4em;
                float: right;
                border-radius: 0.4em;
                border: solid 0;
                background: transparent;
                box-shadow: 1px 1px 2px rgba(0, 0, 0, 0.2) inset, rgba(255, 255, 255, 0.7) 1px 1px 2px;
            }
            .flex-form .field fieldset :not(:first-of-type) {
                border-left: 1px solid #a56ac0;
            }
            .flex-form .field fieldset :first-of-type {
                padding-left: 0.4em;
            }
            .flex-form .field fieldset :last-of-type {
                padding-right: 0.4em;
            }
            .flex-form .field fieldset {
                padding: 0;
                overflow: hidden;
                border: 1px solid purple;
                background: rgb(201, 177, 212);
                border-radius: 1em;
                float: right;
                display: inline-flex; /*ignores whitespace*/
            }
            .flex-form .field fieldset label {
                padding: 0 0.2em;
                line-height: 1.7em;
                text-align: super;
                color: rgb(165, 106, 192);
            }
            .flex-form .field fieldset input {
                display: none;
            }
            .flex-form .field fieldset input:checked + label {
                background: rgb(165, 106, 192);
                text-shadow: rebeccapurple 1px 1px;
                color: rgb(240, 236, 241);
            }
            .flex-form .field abbr {
                position: absolute;
                right: 2.3em;
            }
            .flex-form .field.spacer {
                visibility: hidden;
            }
            .flex-form .command {
                display: flex;
                flex-wrap: wrap-reverse;
                justify-content: space-evenly;
                background: transparent;
                border: transparent;
            }
            .flex-form .command button,
            .flex-form .command a {
                flex-grow: 0;
                height: 1.8em;
            }
            .flex-form .field fieldset label[for="GreenTheme"],
            .flex-form .field fieldset label[for="RedTheme"],
            .flex-form .field fieldset label[for="BlueTheme"],
            .flex-form .field fieldset label[for="BlackTheme"] {
                min-width: 2em;
                color: rgba(0, 0, 0, 0);
                text-align: center;
            }
            .flex-form .field fieldset label[for="GreenTheme"] {
                background: #88c1a4;
            }
            .flex-form .field fieldset input:checked + label[for="GreenTheme"] {
                background: #00a650;
            }
            .flex-form .field fieldset label[for="RedTheme"] {
                background: #e5a8aa;
            }
            .flex-form .field fieldset input:checked + label[for="RedTheme"] {
                background: #e63138;
            }
            .flex-form .field fieldset label[for="BlueTheme"] {
                background: #8fc2d6;
            }
            .flex-form .field fieldset input:checked + label[for="BlueTheme"] {
                background: #31b3e6;
            }
            .flex-form .field fieldset label[for="BlackTheme"] {
                background: #535353;
            }
            .flex-form .field fieldset input:checked + label[for="BlackTheme"] {
                background: #1d1d1d;
            }
        </style>
        <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
    </head>
    <body>
        <main>
            <div class="flex-form">
                <div class="group">
                    <div class="field">
                        <label for="WidthTotal" title="Outer Width">Width</label><abbr>mm</abbr>
                        <input id="WidthTotal" type="number" value="140" min="40" max="400" title="Outer Width" />
                    </div>
                    <div class="field">
                        <label for="LengthTotal" title="Outer Length">Length</label><abbr>mm</abbr>
                        <input id="LengthTotal" type="number" value="229" min="40" max="600" title="Outer Length" />
                    </div>
                </div>
                <div class="group">
                    <div class="field">
                        <label title="Include pouch sides?">Corner Rounding</label>
                        <fieldset>
                            <input id="IncludeCornerRounding" name="CornerRounding" type="radio" value="true" title="Include corner rounding on the pouch?" data-show="#CornerRoundingRadiusSection" />
                            <label for="IncludeCornerRounding" title="Adds a corner rounding to the pouch">yes</label>
                            <input id="ExcludeCornerRounding" name="CornerRounding" type="radio" value="false" checked title="No corner rounding on the pouch?" data-hide="#CornerRoundingRadiusSection" />
                            <label for="ExcludeCornerRounding" title="No corner rounding on the pouch">no</label>
                        </fieldset>
                    </div>
                    <div id="CornerRoundingRadiusSection" class="field">
                        <label for="CornerRoundingRadius" title="The radius of the pouch corners">Radius</label><abbr>mm</abbr>
                        <input id="CornerRoundingRadius" type="number" value="5" min="5" max="25" title="The radius of the pouch corners" />
                    </div>
                </div>
                <div class="group">
                    <div class="field">
                        <label title="Pouch can stand on end?">Gusset</label>
                        <fieldset>
                            <input id="IncludeGussetRounded" name="GussetMain" type="radio" value="Rounded" title="Adds a gusset to the bottom of the pouch. Pouch can be stood up" data-show="#GussetDepthSection, #SidesWidthSection>em" data-vanish="#SidesWidthSection>input,#SidesWidthSection>abbr" />
                            <label for="IncludeGussetRounded" title="Pouch can stand on end?">rounded</label>
                            <input id="IncludeGussetK" name="GussetMain" type="radio" value="K" title="Adds a gusset to the bottom of the pouch. Pouch can be stood up" data-show="#GussetDepthSection, #SidesWidthSection>em" data-vanish="#SidesWidthSection>input,#SidesWidthSection>abbr" />
                            <label for="IncludeGussetK" title="Pouch can stand on end?">&nbsp;k&nbsp;</label>
                            <input id="ExcludeGusset" name="GussetMain" type="radio" value="false" checked title="No gusset on the pouch" data-hide="#GussetDepthSection" data-show="#SidesWidthSection>input,#SidesWidthSection>abbr" data-vanish="#SidesWidthSection>em" />
                            <label for="ExcludeGusset" title="Pouch can stand on end?">none</label>
                        </fieldset>
                    </div>
                    <div id="GussetDepthSection" class="field">
                        <label for="GussetDepth" title="Gusset overal size from front face to back face including seal">Size</label><abbr>mm</abbr>
                        <input id="GussetDepth" type="number" value="76" min="10" max="400" title="Gusset depth including seal" />
                    </div>
                </div>
                <div class="group">
                    <div class="field">
                        <label title="Include pouch sides?">Sides</label>
                        <fieldset>
                            <input id="IncludeSides" name="Sides" type="radio" value="true" title="Include left and right sides on the pouch?" data-show="#SidesWidthSection" />
                            <label for="IncludeSides" title="Adds a left and right side to the pouch">yes</label>
                            <input id="ExcludeSides" name="Sides" type="radio" value="false" checked title="No left and right sides on the pouch?" data-hide="#SidesWidthSection" />
                            <label for="ExcludeSides" title="No left and right side on the pouch">no</label>
                        </fieldset>
                    </div>
                    <div id="SidesWidthSection" class="field">
                        <label for="SideWidth" title="The width of each pouch side from the front of the pouch to the back">Width</label><abbr>mm</abbr>
                        <input id="SideWidth" type="number" value="70" min="40" max="600" title="The width of each pouch side" />
                        <em title="Side widths are matched to gusset size; change the gusset size or turn off gusset to adjust widths">see gusset</em>
                    </div>
                </div>
                <div class="group">
                    <div class="field">
                        <label title="How pouch will be sealed">Seal Placement</label>
                        <fieldset>
                            <input id="SealTopSides" name="SealPlacement" type="radio" value="Top,Left,Right" title="Top and sides will be sealed" />
                            <label for="SealTopSides" title="Apply a top and side seals?">top</label>
                            <input id="SealBottomSides" name="SealPlacement" type="radio" value="Bottom,Left,Right" checked title="Bottom and sides will be sealed" />
                            <label for="SealBottomSides" title="Apply a bottom and side seals?">bottom</label>
                            <input id="SealSidesOnly" name="SealPlacement" type="radio" value="Left,Right" title="Sides will be sealed" />
                            <label for="SealSidesOnly" title="Apply only side seals?">sides</label>
                        </fieldset>
                    </div>
                    <div class="field">
                        <label for="SealSize" title="The amount of edge material used for sealing the pouch">Seal Size</label>
                        <abbr>mm</abbr><input id="SealSize" type="number" value="7.5" min="5" step="0.1" title="The amount of edge material used for sealing the pouch" />
                    </div>
                </div>
                <div class="group">
                    <div class="field">
                        <label title="Include a zipper for reclosing the pouch?">Zipper</label>
                        <fieldset>
                            <input id="IncludeStandardZipper" name="ZipperMain" type="radio" value="Standard" title="Include a standard zipper for reclosing the pouch?" data-show="#ZipperOffsetSection" data-hide="#ZipperFacetSection" />
                            <label for="IncludeStandardZipper" title="Adds a standard zipper to the pouch">standard</label>
                            <input id="IncludeEasyPullZipper" name="ZipperMain" type="radio" value="EasyPull" title="Include an easy-pull zipper for reclosing the pouch?" data-show="#ZipperOffsetSection,#ZipperFacetSection" />
                            <label for="IncludeEasyPullZipper" title="Adds an easy-pull zipper to the pouch">ez-pull</label>
                            <input id="IncludeChildResistantZipper" name="ZipperMain" type="radio" value="ChildResistant" title="Include a child-resistant zipper for reclosing the pouch?" data-show="#ZipperOffsetSection" data-hide="#ZipperFacetSection" />
                            <label for="IncludeChildResistantZipper" title="Adds a child-reistant zipper to the pouch">saftey</label>
                            <input id="ExcludeZipper" name="ZipperMain" type="radio" value="false" checked title="No zipper for reclosing the pouch?" data-hide="#ZipperOffsetSection,#ZipperFacetSection" />
                            <label for="ExcludeZipper" title="No zipper on the pouch">none</label>
                        </fieldset>
                    </div>
                    <div id="ZipperOffsetSection" class="field">
                        <label for="ZipperOffset" title="The distance from the edge of the pouch to the top of the zipper">Offset</label><abbr>mm</abbr>
                        <input id="ZipperOffset" type="number" value="25" title="The distance from the edge of the pouch to the top of the zipper" />
                    </div>
                    <div id="ZipperFacetSection" class="field">
                        <label title="Which bag side to place the zipper on?">Placement</label>
                        <fieldset>
                            <input id="ZipperFacetFront" name="ZipperFacet" type="radio" value="Front" checked title="Add zipper to the front of the pouch?" />
                            <label for="ZipperFacetFront" title="Adds zipper to front">front</label>
                            <input id="ZipperFacetBack" name="ZipperFacet" type="radio" value="Back" title="Add zipper to the back of the pouch?" />
                            <label for="ZipperFacetBack" title="Adds zipper to back">back</label>
                        </fieldset>
                    </div>
                </div>
                <div class="group">
                    <div class="field">
                        <label for="" title="Include a tear notch for easy pouch opening?">Tear Notch</label>
                        <fieldset>
                            <input id="IncludeNotch" name="Notch" type="radio" value="true" title="Include a tear notch for easy pouch opening?" data-show="#NotchOffsetSection" />
                            <label for="IncludeNotch" title="Adds a tear notch to the pouch">yes</label>
                            <input id="ExcludeNotch" name="Notch" type="radio" value="false" checked title="No tear notch for easy opening of the pouch?" data-hide="#NotchOffsetSection" />
                            <label for="ExcludeNotch" title="No tear notch on the pouch">no</label>
                        </fieldset>
                    </div>
                    <div id="NotchOffsetSection" class="field">
                        <label for="NotchOffset" title="The distance from the edge of the pouch to the center of the tear notch">Notch Offset</label>
                        <abbr>mm</abbr>
                        <input id="NotchOffset" type="number" value="20" title="he distance from the edge of the pouch to the center of the tear notch" />
                    </div>
                </div>
                <div class="group">
                    <div class="field">
                        <label title="Include a hang hole for easy pouch opening?">Hang Hole</label>
                        <fieldset>
                            <input id="IncludeHole" name="Hole" type="radio" value="true" title="Include a hole for hanging the pouch?" data-show="#HoleOffsetSection" />
                            <label for="IncludeHole" title="Adds a hang hole to the pouch">yes</label>
                            <input id="ExcludeHole" name="Hole" type="radio" value="false" checked title="No hole for hanging the pouch?" data-hide="#HoleOffsetSection" />
                            <label for="ExcludeHole" title="No hang hole on the pouch">no</label>
                        </fieldset>
                    </div>
                    <div id="HoleOffsetSection" class="field">
                        <label for="HoleOffset" title="The distance from the edge of the pouch to the top of the hang hole">Hang Hole Offset</label><abbr>mm</abbr>
                        <input id="HoleOffset" type="number" value="8" min="6" max="40" title="The distance from the edge of the pouch to the top of the hang hole" />
                    </div>
                </div>
                <div class="group">
                    <div class="field">
                        <label title="Include a degasser valve?">Degas Valve</label>
                        <fieldset>
                            <input id="IncludeDegasserFront" name="DegasserMain" type="radio" value="Front" title="Add degassing valve to the front of the pouch?" data-show="#DegasserOffsetSection" />
                            <label for="IncludeDegasserFront" title="Adds degassing valve to front">front</label>
                            <input id="IncludeDegasserBack" name="DegasserMain" type="radio" value="Back" checked title="Add degassing valve to the back of the pouch?" data-show="#DegasserOffsetSection" />
                            <label for="IncludeDegasserBack" title="Adds degassing valve to back">back</label>
                            <input id="ExcludeDegasser" name="DegasserMain" type="radio" value="false" checked title="No degasser valve?" data-hide="#DegasserOffsetSection" />
                            <label for="ExcludeDegasser" title="No degasser valve on the pouch">none</label>
                        </fieldset>
                    </div>
                    <div id="DegasserOffsetSection" class="field">
                        <label for="DegasserOffset" title="The distance from the edge of the pouch to the top of the degassing valve">Degas Valve Offset</label><abbr>mm</abbr>
                        <input id="DegasserOffset" type="number" value="60" min="18" max="400" title="The distance from the edge of the pouch to the top of the degasser valve" />
                    </div>
                </div>
                <div class="group">
                    <div class="field">
                        <label title="Color theme?">Color Theme</label>
                        <fieldset>
                            <input id="GreenTheme" name="ColorTheme" type="radio" value="theme-green" checked title="Use a green theme?" />
                            <label for="GreenTheme" title="Applies a green theme">_</label>
                            <input id="RedTheme" name="ColorTheme" type="radio" value="theme-red" title="Use a red theme?" />
                            <label for="RedTheme" title="Applies a red theme">_</label>
                            <input id="BlueTheme" name="ColorTheme" type="radio" value="theme-blue" title="Use a blue theme?" />
                            <label for="BlueTheme" title="Applies a blue theme">_</label>
                            <input id="BlackTheme" name="ColorTheme" type="radio" value="theme-black" title="Use a black theme?" />
                            <label for="BlackTheme" title="Applies a black theme">_</label>
                        </fieldset>
                    </div>
                    <div class="field">
                        <label>&nbsp;</label>
                    </div>
                </div>
                <div class="group">
                    <div class="field">
                        <label title="Include inking details?">Inking Details</label>
                        <fieldset>
                            <input id="IncludeInkingDetails" name="InkingDetails" type="radio" value="true" title="Includes inking details?" data-show="#FinishSection" />
                            <label for="IncludeInkingDetails" title="Adds inking details">yes</label>
                            <input id="ExcludeInkingDetails" name="InkingDetails" type="radio" value="false" checked title="No inking details?" data-hide="#FinishSection" />
                            <label for="ExcludeInkingDetails" title="No inking details">no</label>
                        </fieldset>
                    </div>
                    <div id="FinishSection" class="field">
                        <label title="Choose the desired ink finish.">Finish</label>
                        <fieldset>
                            <input id="GlossFinish" name="Finish" type="radio" value="gloss" title="Apply a gloss finish to the pouch?" />
                            <label for="GlossFinish" title="Applies a gloss finish to the pouch">gloss</label>
                            <input id="MatteFinish" name="Finish" type="radio" value="matte" title="Apply a matte finish to the pouch?" />
                            <label for="MatteFinish" title="Applies a matte finish to the pouch">matte</label>
                            <input id="CustomFinish" name="Finish" type="radio" value="custom" checked title="Apply a custom finish to the pouch?" />
                            <label for="CustomFinish" title="Applies a custom finish to the pouch">custom</label>
                        </fieldset>
                    </div>
                </div>
                <div class="group">
                    <div class="field">
                        <label title="Include additional labels?">Labeling Verbosity</label>
                        <fieldset>
                            <input id="StandardLabelingVerbosity" name="LabelingVerbosity" type="radio" value="standard" checked title="No additional labels?" />
                            <label for="StandardLabelingVerbosity" title="No additional labels">standard</label>
                            <input id="DetailedLabelingVerbosity" name="LabelingVerbosity" type="radio" value="detailed" title="Include additional labels?" />
                            <label for="DetailedLabelingVerbosity" title="Additional Labels">detailed</label>
                        </fieldset>
                    </div>
                    <div class="field">
                        <label>&nbsp;</label>
                    </div>
                </div>
                <div class="field command">
                    <button id="Download" style="margin-top: 1em">Download</button>
                </div>
                <div class="spacer field">
                    <label></label>
                    <fieldset></fieldset>
                </div>
                <div class="spacer field">
                    <label></label>
                    <fieldset></fieldset>
                </div>
                <div class="spacer field">
                    <label></label>
                    <fieldset></fieldset>
                </div>
            </div>
        </main>
        <aside></aside>
        <script>
            class _Elements {
                _elements;
                constructor(domElements) {
                    this._elements = domElements;
                }
                get length() {
                    return this._elements.length;
                }
                appendTo(_newParent) {
                    $(this._elements).appendTo($(_newParent._elements));
                    return this;
                }
                attr(name, value) {
                    this._elements.forEach((el) => {
                        el.setAttribute(name, value);
                    });
                    return this;
                }
                children(selector) {
                    return new _Elements($.makeArray($(this._elements).children(selector)));
                }
                clone() {
                    return new _Elements($.makeArray($(this._elements).clone()));
                }
                create(elementName, prepend) {
                    var elements = [];
                    this._elements.forEach((el) => {
                        let newEl = document.createElementNS("http://www.w3.org/2000/svg", elementName);
                        if (prepend) el.prepend(newEl);
                        else el.appendChild(newEl);
                        elements.push(newEl);
                    });
                    return new _Elements(elements);
                }
                // create2(elementName) {
                //     var elements = [];
                //     this._elements.forEach((el) => {
                //         let newEl = document.createElementNS("http://www.w3.org/2000/svg", elementName);
                //         el.appendChild(newEl);
                //         elements.push(newEl);
                //     });
                //     return new _Elements(elements);
                // }
                find(selector) {
                    return new _Elements($.makeArray($(this._elements).find(selector)));
                }
                remove() {
                    $(this._elements).remove();
                    return this;
                }
                text(innerText) {
                    $(this._elements).text(innerText);
                    return this;
                }
                toggleClass(classes) {
                    $(this._elements).toggleClass(classes);
                    return this;
                }
            }
            function _(selector) {
                return new _Elements($.makeArray($(selector)));
            }
        </script>
        <script type="module">
            import { PouchTemplate } from "./js/templates/PouchTemplate.js";
            import { Placement } from "./js/enums/Placement.js";
            import { ZipperType } from "./js/enums/ZipperType.js";
            import { GussetType } from "./js/enums/GussetType.js";
            import { FacetPlacement } from "./js/enums/FacetPlacement.js";

            let pouch = PouchTemplate.getDefault(UpdateSvg);
            let layout = new (class {
                _themeClass = "theme-green";
                _verboseLabels = false;
                _inkingDetails = true;
                _finish = "custom";
                _changed = false;
                _frozen = false;
                get themeClass() {
                    return this._themeClass;
                }
                set themeClass(value) {
                    if (this._themeClass != value) this._changed = true;
                    this._themeClass = value;
                }
                get verboseLabels() {
                    return this._verboseLabels;
                }
                set verboseLabels(value) {
                    if (this._verboseLabels != value) this._changed = true;
                    this._verboseLabels = value;
                }
                get inkingDetails() {
                    return this._inkingDetails;
                }
                set inkingDetails(value) {
                    if (this._inkingDetails != value) this._changed = true;
                    this._inkingDetails = value;
                }
                get finish() {
                    return this._finish;
                }
                set finish(value) {
                    if (this._finish != value) this._changed = true;
                    this._finish = value;
                }
                get changed() {
                    return this._changed;
                }
                set changed(value) {
                    this._changed = value;
                }
                get themeClass() {
                    return this._themeClass;
                }
                get themeClass() {
                    return this._themeClass;
                }
                get frozen() {
                    return this._frozen;
                }
                freeze() {
                    this._frozen = true;
                }
                unfreeze() {
                    this._frozen = false;
                }
            })();
            console.log(layout);
            let svgNotchLarge = "m4.5 0 0-9-4.5-5.5-4.5 5.5 0 9z";
            let svgArrowLarge = "m0 0c2.57 10.57 3.37 12.44 4.29 14.75l-8.77 0c.39-.83 1.73-4.18 2.59-7.05.93-3.08 1.57-5.87 1.79-7.68";
            let svgArrowSmall = "m0 0c-1.7 6.86-2.22 8.07-2.82 9.56h5.67c-.25-.53-1.11-2.7-1.68-4.62-.6-1.99-1.04-3.79-1.16-4.97";
            let svgX =
                "m186 306c-8-8-27.5-32-44-54-16-22-31-40.5-33-41.5-2-.5-12.5 17-23 39.5-22 44.5-37.5 60-50 49.5-4-3.5-7.5-9-7.5-12.5 0-3.5 12-31 27-61.5l27.5-55.5-27-45c-44.5-73.5-60.5-108.5-53-117 3-4 10-7 14.5-6 4.5 1 10 2 12 2 2 .5 18.5 29.5 37.5 65.5 18.5 35.5 35 65 36.5 65 1.5-.5 10-13 19-29 9-16 24-37 33.5-47.5 15.5-16.5 18.5-18 27.5-12.5 5.5 3.5 10 7.5 10 9.5 0 1.5-14.5 27-32.5 57-18 29.5-32.5 56.5-32.5 59.5 0 3 18 29 40 58 62 80.5 58.5 75 47.5 83-12.5 9.5-14 9-30-6.5z";
            let svgCheck =
                "m210 13c-19 16.5-72.5 109.5-95.5 165.5-11 26.5-21 48-22.5 48-1.5 0-12.5-14-25-31-12.5-17-26.5-31.5-31.5-32.5-13-2.5-33.5 3-33.5 9 0 2.5 10.5 16.5 24 31 13 14.5 30.5 37.5 38.5 50.5 13.5 21.5 16.5 23.5 32 22.5 16.5-1.5 17.5-2.5 40.5-59.5 26.5-65.5 49-108.5 88.5-165.5 14.5-21.5 26.5-41.5 26.5-44 0-9.5-29.5-5-42 6z";

            //radio event binding
            $("[data-show]").on("change", function (ev) {
                let $t = $(ev.target).filter(":checked");
                if ($t.length) showByData($t.data("show"));
            });
            $("[data-hide]").on("change", function (ev) {
                //hidden is visibility:hidden;
                let $t = $(ev.target).filter(":checked");
                if ($t.length) hideByData($t.data("hide"));
            });
            $("[data-vanish]").on("change", function (ev) {
                //vanished is display:none;
                let $t = $(ev.target).filter(":checked");
                if ($t.length) vanishByData($t.data("vanish"));
            });

            function ensureShown() {
                $("[data-show]:checked").each((i, el) => {
                    showByData($(el).data("show"));
                });
            }
            function ensureHidden() {
                $("[data-hide]:checked").each((i, el) => {
                    hideByData($(el).data("hide"));
                });
            }
            function ensureVanished() {
                $("[data-vanish]:checked").each((i, el) => {
                    vanishByData($(el).data("vanish"));
                });
            }

            function showByData(selector) {
                $(selector).css("visibility", "").css("display", "");
                ensureHidden();
                ensureVanished();
            }
            function hideByData(selector) {
                $(selector).css("visibility", "hidden");
            }
            function vanishByData(selector) {
                $(selector).css("display", "none");
            }

            //initialize show/hide based on current checks (show before hide i.e. (show + show == show, show + hide == hide, hide + hide == hide))
            ensureShown();

            //--load svg--//
            console.log(pouch); //TODO: remove;
            CreateSvg();
            UpdateSvg(); //update once after creating

            //--bindings--//
            $("#WidthTotal").on("change", function (ev) {
                pouch.front.width.value = ev.target.value * 1;
            });
            $("#LengthTotal").on("change", function (ev) {
                pouch.front.height.value = ev.target.value * 1;
            });
            $("#IncludeCornerRounding").on("change", function (ev) {
                pouch.corners.included = ev.target.checked;
            });
            $("#ExcludeCornerRounding").on("change", function (ev) {
                pouch.corners.included = !ev.target.checked;
            });
            $("#CornerRoundingRadius").on("change", function (ev) {
                pouch.corners.radius.value = ev.target.value * 1;
            });
            // pouch.corners.included = $("#IncludeCornerRounding").is(":checked");
            // pouch.corners.radius.value = $("#CornerRoundingRadius").val();
            $("#IncludeGussetRounded").on("change", function (ev) {
                pouch.gusset.included = ev.target.checked;
                if (ev.target.checked) {
                    $("[for=SealTopSides]")
                        .css("text-decoration", "line-through 2px #777")
                        .on("click", function () {
                            alert("Cannot place a top seal when a gusset is included");
                            return false;
                        });
                    $("#SealBottomSides").click();
                    $("[for=SealBottomSides]").css("text-decoration", "").off("click");
                }
            });
            $("#IncludeGussetK").on("change", function (ev) {
                pouch.gusset.included = ev.target.checked;
                if (ev.target.checked) {
                    $("[for=SealTopSides]")
                        .css("text-decoration", "line-through 2px #777")
                        .on("click", function () {
                            alert("Cannot place a top seal when a gusset is included");
                            return false;
                        });
                    $("[for=SealBottomSides]")
                        .css("text-decoration", "line-through 2px #777")
                        .on("click", function () {
                            alert("Cannot place a top seal when a k-gusset is included");
                            return false;
                        });
                    $("#SealSidesOnly").click();
                }
            });
            $("#ExcludeGusset").on("change", function (ev) {
                pouch.gusset.included = !ev.target.checked;
                if (ev.target.checked) {
                    $("[for=SealTopSides]").css("text-decoration", "").off("click");
                    $("[for=SealBottomSides]").css("text-decoration", "").off("click");
                }
            });
            if ($("#IncludeGussetRounded")[0].checked) {
                //toggle initial state back and forth to ensure that events and styles are added.
                $("#ExcludeGusset").click();
                $("#IncludeGussetRounded").click();
            }
            if ($("#IncludeGussetK")[0].checked) {
                //toggle initial state back and forth to ensure that events and styles are added.
                $("#ExcludeGusset").click();
                $("#IncludeGussetK").click();
            }
            $("#GussetDepth").on("change", function (ev) {
                pouch.gusset.depth.value = ev.target.value * 1;
            });
            $("#IncludeSides").on("change", function (ev) {
                pouch.left.included = ev.target.checked;
            });
            $("#ExcludeSides").on("change", function (ev) {
                pouch.right.included = !ev.target.checked;
            });
            $("#SealSize").on("change", function (ev) {
                pouch.seal.width.value = ev.target.value * 1;
            });
            $("[name=SealPlacement]").on("change", function (ev) {
                if (ev.target.checked) {
                    pouch.seal.placements = ev.target.value.split(",").map((p) => Placement[p]);
                }
            });
            $("#IncludeStandardZipper").on("change", function (ev) {
                pouch.zipper.included = ev.target.checked;
                if (pouch.zipper.included) {
                    pouch.zipper.type = ZipperType.Standard;
                    $("[for=IncludeNotch]").css("text-decoration", "").off("click");
                }
            });
            $("#IncludeEasyPullZipper").on("change", function (ev) {
                pouch.zipper.included = ev.target.checked;
                if (pouch.zipper.included) {
                    pouch.zipper.type = ZipperType.EasyPull;
                    $("[for=IncludeNotch]")
                        .css("text-decoration", "line-through 2px #777") /////////////////////////
                        .on("click", function () {
                            alert("Cannot place a tear notch when an easy-pull zipper is included");
                            return false;
                        });
                    $("#ExcludeNotch").click();
                }
            });
            $("#IncludeChildResistantZipper").on("change", function (ev) {
                pouch.zipper.included = ev.target.checked;
                if (pouch.zipper.included) {
                    pouch.zipper.type = ZipperType.ChildResistant;
                    $("[for=IncludeNotch]").css("text-decoration", "").off("click");
                }
            });
            $("#ExcludeZipper").on("change", function (ev) {
                pouch.zipper.included = !ev.target.checked;
                if (ev.target.checked) {
                    $("[for=IncludeNotch]").css("text-decoration", "").off("click");
                }
            });
            if ($("#IncludeEasyPullZipper")[0].checked) {
                //toggle initial state back and forth to ensure that events and styles are added.
                $("#ExcludeZipper").click();
                $("#IncludeEasyPullZipper").click();
            }
            $("#ZipperOffset").on("change", function (ev) {
                pouch.zipper.offset.value = ev.target.value * 1;
            });

            $("#ZipperFacetFront").on("change", function (ev) {
                pouch.zipper.facet = FacetPlacement.Front;
            });
            $("#ZipperFacetBack").on("change", function (ev) {
                pouch.zipper.facet = FacetPlacement.Back;
            });
            if ($("#ZipperFacetBack")[0].checked) {
                //toggle initial state back and forth to ensure that events and styles are added.
                $("#ZipperFacetFront").click();
                $("#ZipperFacetBack").click();
            }
            if ($("#ZipperFacetFront")[0].checked) {
                //toggle initial state back and forth to ensure that events and styles are added.
                $("#ZipperFacetBack").click();
                $("#ZipperFacetFront").click();
            }
            $("#IncludeNotch").on("change", function (ev) {
                pouch.notch.included = ev.target.checked;
            });
            $("#ExcludeNotch").on("change", function (ev) {
                pouch.notch.included = !ev.target.checked;
            });
            $("#NotchOffset").on("change", function (ev) {
                pouch.notch.offset.value = ev.target.value * 1;
            });
            $("#IncludeHole").on("change", function (ev) {
                pouch.hanger.included = ev.target.checked;
            });
            $("#ExcludeHole").on("change", function (ev) {
                pouch.hanger.included = !ev.target.checked;
            });
            $("#HoleOffset").on("change", function (ev) {
                pouch.hanger.offset.value = ev.target.value * 1;
            });
            $("#IncludeDegasserFront").on("change", function (ev) {
                if (ev.target.checked) {
                    pouch.degasser.included = true;
                    pouch.degasser.facet = FacetPlacement.Front;
                }
            });
            $("#IncludeDegasserBack").on("change", function (ev) {
                if (ev.target.checked) {
                    pouch.degasser.included = true;
                    pouch.degasser.facet = FacetPlacement.Back;
                }
            });
            $("#ExcludeDegasser").on("change", function (ev) {
                pouch.degasser.included = !ev.target.checked;
            });
            $("#DegasserOffset").on("change", function (ev) {
                pouch.degasser.offset.value = ev.target.value * 1;
            });

            if ($("#IncludeDegasserBack")[0].checked) {
                //toggle initial state back and forth to ensure that events and styles are added.
                $("#ExcludeDegasser").click();
                $("#IncludeDegasserBack").click();
            }
            if ($("#IncludeDegasserFront")[0].checked) {
                //toggle initial state back and forth to ensure that events and styles are added.
                $("#ExcludeDegasser").click();
                $("#IncludeDegasserFront").click();
            }

            $("#IncludeInkingDetails").on("change", function (ev) {
                layout.inkingDetails = ev.target.checked;
            });
            $("#ExcludeInkingDetails").on("change", function (ev) {
                layout.inkingDetails = !ev.target.checked;
            });
            $("#GlossFinish").on("change", function (ev) {
                if (ev.target.checked) layout.finish = ev.target.value;
            });
            $("#MatteFinish").on("change", function (ev) {
                if (ev.target.checked) layout.finish = ev.target.value;
            });
            $("#CustomFinish").on("change", function (ev) {
                if (ev.target.checked) layout.finish = ev.target.value;
            });
            $("#StandardLabelingVerbosity").on("change", function (ev) {
                layout.verboseLabels = !ev.target.checked;
            });
            $("#DetailedLabelingVerbosity").on("change", function (ev) {
                layout.verboseLabels = ev.target.checked;
            });

            //--periodic model updating variables--//  //NOTE: these variables must reference elements otherwise updates will not work.
            let w = $("#WidthTotal")[0],
                h = $("#LengthTotal")[0],
                yesCorners = $("#IncludeCornerRounding")[0],
                cornerRadius = $("#CornerRoundingRadius")[0],
                gussetMain = $("[name=GussetMain]"),
                gussetDepth = $("#GussetDepth")[0],
                yesSides = $("#IncludeSides")[0],
                sides = $("#SideWidth")[0],
                seal = $("#SealSize")[0],
                sealPlacement = $("[name=SealPlacement]"),
                noZipper = $("#ExcludeZipper")[0],
                zipperMain = $("[name=ZipperMain]"),
                zipperOffset = $("#ZipperOffset")[0],
                zipperFacet = $("[name=ZipperFacet]"),
                yesNotch = $("#IncludeNotch")[0],
                notch = $("#NotchOffset")[0],
                yesHanger = $("#IncludeHole")[0],
                hanger = $("#HoleOffset")[0],
                degasserMain = $("[name=DegasserMain]"),
                degasserOffset = $("#DegasserOffset")[0],
                theme = $("[name=ColorTheme]"),
                yesInkingDetails = $("#IncludeInkingDetails")[0],
                finish = $("[name=Finish]"),
                yesVerboseLabels = $("#DetailedLabelingVerbosity")[0];

            (function UpdateModel() {
                let main = null;
                let otherSvgChange = false;
                pouch.front.width.value = w.value * 1;
                pouch.front.height.value = h.value * 1;
                pouch.corners.included = yesCorners.checked;
                pouch.corners.radius.value = cornerRadius.value * 1;
                main = gussetMain.filter(":checked").val();
                pouch.gusset.included = main != "false";
                pouch.gusset.depth.value = gussetDepth.value * 1;
                if (pouch.gusset.included) pouch.gusset.type = GussetType[main];
                pouch.left.included = yesSides.checked;
                pouch.left.width.value = pouch.gusset.included ? gussetDepth.value * 1 : sides.value * 1; // width is from gusset if the gusset is on
                pouch.seal.width.value = seal.value * 1;
                pouch.seal.placements = sealPlacement
                    .filter(":checked")
                    .val()
                    .split(",")
                    .map((p) => Placement[p]);
                main = zipperMain.filter(":checked").val();
                pouch.zipper.included = main != "false";
                if (pouch.zipper.included) ZipperType[main];
                pouch.zipper.offset.value = zipperOffset.value * 1;
                if (pouch.zipper.facet == ZipperType.EasyPull) pouch.zipper.facet = FacetPlacement[zipperFacet.filter((i, el) => $(el).is(":checked")).val()];
                pouch.zipper.height.value = pouch.zipper.type == ZipperType.ChildResistant ? 15 : 13;
                pouch.notch.included = yesNotch.checked;
                pouch.notch.offset.value = notch.value * 1;
                pouch.hanger.included = yesHanger.checked;
                pouch.hanger.offset.value = hanger.value * 1;
                main = degasserMain.filter(":checked").val();
                pouch.degasser.included = main != "false";
                pouch.degasser.offset.value = degasserOffset.value * 1;
                if (pouch.degasser.included) pouch.degasser.facet = FacetPlacement[main];
                setTimeout(UpdateModel, 100);
                layout.themeClass = theme.not(":not(:checked)")[0].value;
                layout.inkingDetails = yesInkingDetails.checked;
                layout.finish = finish.not(":not(:checked)")[0].value;
                layout.verboseLabels = yesVerboseLabels.checked;
                if (layout.changed) {
                    //a change not tracked by the pouch object
                    layout.changed = false;
                    UpdateSvg();
                }
            })();

            //--create svg--//
            function CreateSvg() {
                let _svg = _("aside").create("svg").attr("xmlns", "http://www.w3.org/2000/svg");
                let _style = _svg.create("style").attr("type", "text/css");
                $.get("svg.css", function (text) {
                    text = text.replace(/\/\*.*\*\//g, ""); //matches single line comments
                    _style.text(text);
                });
                let _front = _svg.create("svg").attr("class", "side front").attr("overflow", "visible");

                //header label//
                let _header = _front.create("g").attr("class", "header");
                _header.create("rect").attr("class", "label background fill dark face");
                _header.create("text").attr("class", "label left fill light medium").text("FRONT");
                _header.create("text").attr("class", "label center fill light medium").text("(OPENING)");
                _header.create("text").attr("class", "label right fill light medium").text("TOP");

                //face//
                let _face = _front.create("g").attr("class", "face");
                _face.create("clipPath").attr("id", "FaceUpperClip").create("rect").attr("class", "clip upper");
                _face.create("clipPath").attr("id", "FaceLowerClip").create("rect").attr("class", "clip lower");
                _face.create("rect").attr("class", "outline upper continuous large").attr("clip-path", "url(#FaceUpperClip)");
                _face.create("rect").attr("class", "outline lower continuous large").attr("clip-path", "url(#FaceLowerClip)");

                //face outer height guides//
                let _outerHeight = _face.create("g").attr("class", "height outer");
                _outerHeight.create("text").attr("class", "fill dark medium").attr("text-anchor", "middle").attr("transform", "rotate(-90)");
                _outerHeight.create("line").attr("class", "mark top continuous medium");
                _outerHeight.create("svg").attr("class", "arrow top").attr("overflow", "visible").create("path").attr("d", svgArrowLarge).attr("class", "fill");
                _outerHeight.create("line").attr("class", "arrow continuous medium");
                _outerHeight.create("svg").attr("class", "arrow bottom").attr("overflow", "visible").create("path").attr("d", svgArrowLarge).attr("class", "fill").attr("transform", "rotate(180)");
                _outerHeight.create("line").attr("class", "mark bottom continuous medium");

                //face outer width guides//
                let _outerWidth = _face.create("g").attr("class", "width outer");
                _outerWidth.create("text").attr("class", "fill dark medium").attr("text-anchor", "middle");
                _outerWidth.create("line").attr("class", "mark left continuous medium");
                _outerWidth.create("svg").attr("class", "arrow left").attr("overflow", "visible").create("path").attr("d", svgArrowLarge).attr("class", "fill").attr("transform", "rotate(-90)");
                _outerWidth.create("line").attr("class", "arrow continuous medium");
                _outerWidth.create("svg").attr("class", "arrow right").attr("overflow", "visible").create("path").attr("d", svgArrowLarge).attr("class", "fill").attr("transform", "rotate(90)");
                _outerWidth.create("line").attr("class", "mark right continuous medium");

                //face inner height guides//
                let _innerHeight = _face.create("g").attr("class", "height inner verbosity");
                _innerHeight.create("text").attr("class", "fill dark small").attr("text-anchor", "middle").attr("transform", "rotate(-90)");
                _innerHeight.create("line").attr("class", "mark top continuous medium");
                _innerHeight.create("svg").attr("class", "arrow top").attr("overflow", "visible").create("path").attr("d", svgArrowLarge).attr("class", "fill");
                _innerHeight.create("line").attr("class", "arrow continuous medium");
                _innerHeight.create("svg").attr("class", "arrow bottom").attr("overflow", "visible").create("path").attr("d", svgArrowLarge).attr("class", "fill").attr("transform", "rotate(180)");
                _innerHeight.create("line").attr("class", "mark bottom continuous medium");
                _innerHeight.create("svg").attr("class", "mark arrow").attr("overflow", "visible").create("path").attr("d", svgArrowSmall).attr("class", "fill").attr("transform", "rotate(225)");

                //face inner width guides//
                let _innerWidth = _face.create("g").attr("class", "width inner verbosity");
                _innerWidth.create("text").attr("class", "fill dark small").attr("text-anchor", "middle");
                _innerHeight.create("svg").attr("class", "arrow bottom").attr("overflow", "visible").create("path").attr("d", svgArrowLarge).attr("class", "fill").attr("transform", "rotate(180)");
                _innerWidth.create("line").attr("class", "mark left continuous medium");
                _innerWidth.create("svg").attr("class", "arrow left").attr("overflow", "visible").create("path").attr("d", svgArrowLarge).attr("class", "fill").attr("transform", "rotate(-90)");
                _innerWidth.create("line").attr("class", "arrow continuous medium");
                _innerWidth.create("svg").attr("class", "arrow right").attr("overflow", "visible").create("path").attr("d", svgArrowLarge).attr("class", "fill").attr("transform", "rotate(90)");
                _innerWidth.create("line").attr("class", "mark right continuous medium");

                //hanger//
                let _hanger = _front.create("g").attr("class", "hanger");
                _hanger.create("circle").attr("class", "hole fill dark");
                let _hangerOffset = _hanger.create("g").attr("class", "offset");
                _hangerOffset.create("text").attr("class", "value fill dark small");
                _hangerOffset.create("svg").attr("class", "arrow top").attr("overflow", "visible").create("path").attr("d", svgArrowSmall).attr("class", "fill");
                _hangerOffset.create("line").attr("class", "arrow continuous medium");
                _hangerOffset.create("svg").attr("class", "arrow bottom").attr("overflow", "visible").create("path").attr("d", svgArrowSmall).attr("class", "fill").attr("transform", "rotate(180)");
                _hangerOffset.create("line").attr("class", "mark bottom continuous medium");
                _hangerOffset.create("text").attr("class", "type verbosity fill dark small").text("Hole");

                //notch//
                let _notch = _front.create("g").attr("class", "notch");
                _notch.create("svg").attr("class", "cut left fill dark").attr("overflow", "visible").create("path").attr("d", svgNotchLarge).attr("class", "fill").attr("transform", "rotate(90)");
                _notch.create("svg").attr("class", "cut right fill dark").attr("overflow", "visible").create("path").attr("d", svgNotchLarge).attr("class", "fill").attr("transform", "rotate(-90)");
                let _notchOffset = _notch.create("g").attr("class", "offset");
                _notchOffset.create("text").attr("class", "value fill dark small").attr("transform", "rotate(90)");
                _notchOffset.create("line").attr("class", "mark top continuous medium");
                _notchOffset.create("svg").attr("class", "arrow top").attr("overflow", "visible").create("path").attr("d", svgArrowSmall).attr("class", "fill");
                _notchOffset.create("line").attr("class", "arrow continuous medium");
                _notchOffset.create("svg").attr("class", "arrow bottom").attr("overflow", "visible").create("path").attr("d", svgArrowSmall).attr("class", "fill").attr("transform", "rotate(180)");
                _notchOffset.create("line").attr("class", "mark bottom continuous medium");
                let _notchLabel = _notchOffset.create("text").attr("class", "type verbosity fill dark small");
                _notchLabel.create("tspan").attr("class", "upper").text("Tear");
                _notchLabel.create("tspan").attr("class", "lower").text("Notch");

                //zippers//
                let _zipper = _front.create("g").attr("class", "zipper");
                let _straight = _zipper.create("g").attr("class", "straight");
                _straight.create("rect").attr("class", "outline continuous small");
                _straight.create("rect").attr("class", "inner dashed small");
                let _wishbone = _zipper.create("g").attr("class", "wishbone");
                _wishbone.create("clipPath").attr("id", "WishboneUpperTopClip").create("rect").attr("class", "clip top").attr("width", "7.3mm").attr("height", "4mm");
                _wishbone.create("clipPath").attr("id", "WishboneMiddleClip").create("rect").attr("class", "clip middle").attr("width", "2.5mm").attr("height", "10.5mm");
                _wishbone.create("clipPath").attr("id", "WishboneLowerBottomClip").create("rect").attr("class", "clip bottom").attr("width", "7.3mm").attr("height", "4mm");
                _wishbone.create("circle").attr("class", "tear upper top dashed small").attr("clip-path", "url(#WishboneUpperTopClip)").attr("r", "3.5mm");
                _wishbone.create("circle").attr("class", "tear upper bottom dashed small").attr("clip-path", "url(#WishboneMiddleClip)").attr("r", "3mm");
                _wishbone.create("circle").attr("class", "tear lower top dashed small").attr("clip-path", "url(#WishboneMiddleClip)").attr("r", "3mm");
                _wishbone.create("circle").attr("class", "tear lower bottom dashed small").attr("clip-path", "url(#WishboneLowerBottomClip)").attr("r", "3.5mm");
                let _heatedClip = _wishbone.create("clipPath").attr("id", "HeatedClip");
                _heatedClip.create("rect").attr("class", "clip heated").attr("width", "50mm").attr("x", "0mm").attr("y", "0mm");
                _wishbone.create("rect").attr("class", "heated vertical dotted large").attr("clip-path", "url(#HeatedClip)").attr("rx", "2mm");
                _wishbone.create("line").attr("class", "heated horizontal dotted large");
                _wishbone.create("rect").attr("class", "outline continuous small");
                _wishbone.create("rect").attr("class", "inner dashed small");
                let _zipperOffset = _zipper.create("g").attr("class", "offset");
                _zipperOffset.create("text").attr("class", "value fill dark small").attr("transform", "rotate(90)");
                _zipperOffset.create("line").attr("class", "mark top continuous medium");
                _zipperOffset.create("svg").attr("class", "arrow top").attr("overflow", "visible").create("path").attr("d", svgArrowSmall).attr("class", "fill");
                _zipperOffset.create("line").attr("class", "arrow continuous medium");
                _zipperOffset.create("svg").attr("class", "arrow bottom").attr("overflow", "visible").create("path").attr("d", svgArrowSmall).attr("class", "fill").attr("transform", "rotate(180)");
                _zipperOffset.create("line").attr("class", "mark bottom continuous medium");
                let _zipperLabel = _zipperOffset.create("text").attr("class", "type verbosity fill dark small");
                _zipperLabel.create("tspan").attr("class", "upper");
                _zipperLabel.create("tspan").attr("class", "lower");

                //degasser//
                let _degasser = _front.create("g").attr("class", "degasser");
                _degasser.create("circle").attr("class", "outer dotted large");
                _degasser.create("circle").attr("class", "inner continuous small");
                let _degasserOffset = _degasser.create("g").attr("class", "offset");
                _degasserOffset.create("text").attr("class", "value fill dark small").attr("transform", "rotate(-90)");
                _degasserOffset.create("line").attr("class", "mark top continuous medium");
                _degasserOffset.create("svg").attr("class", "arrow top").attr("overflow", "visible").create("path").attr("d", svgArrowSmall).attr("class", "fill");
                _degasserOffset.create("line").attr("class", "arrow continuous medium");
                _degasserOffset.create("svg").attr("class", "arrow bottom").attr("overflow", "visible").create("path").attr("d", svgArrowSmall).attr("class", "fill").attr("transform", "rotate(180)");
                _degasserOffset.create("line").attr("class", "mark bottom continuous medium");
                let _degasserLabel = _degasserOffset.create("text").attr("class", "type verbosity fill dark small");
                _degasserLabel.create("tspan").attr("class", "upper").text("Degas");
                _degasserLabel.create("tspan").attr("class", "lower").text("Valve");

                //seal//
                let _seal = _front.create("g").attr("class", "seal");
                _seal.create("rect").attr("class", "outline dashed medium");
                // let curveClipId = "_" + ("0000" + Math.random().toString(36).replace(".", "")).substr(-5);
                _seal.create("clipPath").attr("id", "CurveClip").create("rect").attr("class", "clip");
                _seal.create("ellipse").attr("class", "curve dashed medium").attr("clip-path", "url(#CurveClip)");
                _seal.create("line").attr("class", "left k-corner dashed medium");
                _seal.create("line").attr("class", "right k-corner dashed medium");
                _seal.create("text").attr("class", "top fill dark small").attr("text-anchor", "middle");
                _seal.create("text").attr("class", "right fill dark small").attr("text-anchor", "middle").attr("transform", "rotate(-90)");
                _seal.create("text").attr("class", "bottom fill dark small").attr("text-anchor", "middle");
                _seal.create("text").attr("class", "left fill dark small").attr("text-anchor", "middle").attr("transform", "rotate(-90)");

                //meridian//
                let _meridian = _front.create("g").attr("class", "meridian");
                _meridian.create("line").attr("class", "divide dashed medium");
                let _meridianOffset = _meridian.create("g").attr("class", "offset");
                _meridianOffset.create("text").attr("class", "fill dark small").attr("transform", "rotate(90)");
                _meridianOffset.create("line").attr("class", "mark top continuous medium");
                _meridianOffset.create("svg").attr("class", "arrow top").attr("overflow", "visible").create("path").attr("d", svgArrowSmall).attr("class", "fill");
                _meridianOffset.create("line").attr("class", "arrow continuous medium");
                _meridianOffset.create("svg").attr("class", "arrow bottom").attr("overflow", "visible").create("path").attr("d", svgArrowSmall).attr("class", "fill").attr("transform", "rotate(180)");
                _meridianOffset.create("line").attr("class", "mark bottom continuous medium");

                //bag features//
                let _features = _svg.create("svg").attr("class", "area features").attr("overflow", "visible");
                _features.create("rect").attr("class", "outline continuous large black").attr("width", "71mm").attr("height", "111mm");
                _features.create("line").attr("class", "divide upper continuous large black").attr("x2", "71mm").attr("y1", "15mm").attr("y2", "15mm");
                _features.create("line").attr("class", "divide lower continuous large black").attr("x2", "71mm").attr("y1", "66mm").attr("y2", "66mm");
                _features.create("text").attr("class", "header fill large black").text("Bag Features").attr("x", "35.5mm").attr("y", "11mm").attr("text-anchor", "middle");

                _features.create("text").attr("class", "label outer fill medium small black").text("Outer Size:").attr("x", "35.5mm").attr("y", "22mm").attr("text-anchor", "middle");
                _features.create("text").attr("class", "value outer fill medium small green").text("<outer-size>").attr("x", "35.5mm").attr("y", "29mm").attr("text-anchor", "middle");
                _features.create("line").attr("class", "divide hr continuous small black").attr("x1", "20mm").attr("x2", "51mm").attr("y1", "32mm").attr("y2", "32mm");
                _features.create("text").attr("class", "label inner fill medium small black").text("Inner Size:").attr("x", "35.5mm").attr("y", "38mm").attr("text-anchor", "middle");
                _features.create("text").attr("class", "value inner fill medium small green").text("<inner-size>").attr("x", "35.5mm").attr("y", "45mm").attr("text-anchor", "middle");
                _features.create("line").attr("class", "divide hr continuous small black").attr("x1", "20mm").attr("x2", "51mm").attr("y1", "48mm").attr("y2", "48mm");
                _features.create("text").attr("class", "label seal fill medium small black").text("Seal Size:").attr("x", "35mm").attr("y", "54mm").attr("text-anchor", "end");
                _features.create("text").attr("class", "value seal fill medium small green").text("<seal-size>").attr("x", "36mm").attr("y", "54mm");
                _features.create("line").attr("class", "divide hr continuous small black").attr("x1", "20mm").attr("x2", "51mm").attr("y1", "57mm").attr("y2", "57mm");
                _features.create("text").attr("class", "label finish fill medium small black").text("Finish:").attr("x", "35mm").attr("y", "63mm").attr("text-anchor", "end");
                _features.create("text").attr("class", "value finish fill medium small green").text("<finish>").attr("x", "36mm").attr("y", "63mm");

                _features.create("text").attr("class", "label hanger fill medium small").text("Hang Hole").attr("x", "32mm").attr("y", "73mm").attr("text-anchor", "middle");
                _features.create("svg").attr("class", "icon hanger fill medium small").attr("x", "46mm").attr("y", "68mm").create("path").attr("transform", "scale(0.055)");
                _features.create("text").attr("class", "label notch fill medium small").text("Tear Notch").attr("x", "32mm").attr("y", "80mm").attr("text-anchor", "middle");
                _features.create("svg").attr("class", "icon notch fill medium small").attr("x", "46mm").attr("y", "75mm").create("path").attr("transform", "scale(0.055)");
                _features.create("text").attr("class", "label degasser fill medium small").text("Degassing Valve").attr("x", "32mm").attr("y", "87mm").attr("text-anchor", "middle");
                _features.create("svg").attr("class", "icon degasser fill medium small").attr("x", "52mm").attr("y", "82mm").create("path").attr("transform", "scale(0.055)");
                _features.create("text").attr("class", "label zipper standard fill medium small").text("Standard Zipper").attr("x", "32mm").attr("y", "94mm").attr("text-anchor", "middle");
                _features.create("svg").attr("class", "icon zipper standard fill medium small").attr("x", "51.5mm").attr("y", "89mm").create("path").attr("transform", "scale(0.055)");
                _features.create("text").attr("class", "label zipper safety fill medium small").text("Child Resistant Zipper").attr("x", "32mm").attr("y", "101mm").attr("text-anchor", "middle");
                _features.create("svg").attr("class", "icon zipper safety fill medium small").attr("x", "59mm").attr("y", "96mm").create("path").attr("transform", "scale(0.055)");
                _features.create("text").attr("class", "label zipper wishbone fill medium small").text("EZ Pull Zipper").attr("x", "32mm").attr("y", "108mm").attr("text-anchor", "middle");
                _features.create("svg").attr("class", "icon zipper wishbone fill medium small").attr("x", "50mm").attr("y", "103mm").create("path").attr("transform", "scale(0.055)");

                //design proof//
                // let _designProof = _svg.create("image").attr("class", "area design");
                // var xhr = new XMLHttpRequest();
                // xhr.responseType = "arraybuffer";
                // xhr.onload = function () {
                //     let blob = new Blob([xhr.response], { type: "image/png" });
                //     let reader = new FileReader();
                //     reader.onload = function () {
                //         _designProof.attr("href", reader.result);
                //     };
                //     let dataUrl = reader.readAsDataURL(blob);
                // };
                // xhr.open("GET", "master-design-proof.png");
                // xhr.send();
            }

            //--adjust svg--//
            function UpdateSvg() {
                if (layout.frozen) return;
                let _svg = _("aside > svg");
                if (_svg.length) {
                    let featuresWidth = 71; //exists in 2 places
                    let horizSpace = 40 + (layout.verboseLabels && pouch.zipper.included ? (pouch.notch.included ? 31.5 : 14) : 0);
                    let vertSpace = 40;
                    let imageWidth = 418;
                    let imageHeight = 270;
                    let designWidth = pouch.right.included ? pouch.front.width.value * 2 + pouch.right.width.value * 2 + horizSpace * 4 : pouch.front.width.value * 2 + horizSpace * 2;
                    let designHeight = pouch.gusset.included ? pouch.front.height.value + pouch.gusset.depth.value + vertSpace * 2 : pouch.front.height.value + vertSpace;
                    let width = layout.inkingDetails ? Math.max(designWidth * 2 + horizSpace, imageWidth) : designWidth + horizSpace;
                    // if (layout.verboseLabels)
                    width += featuresWidth + horizSpace;
                    let height = layout.inkingDetails ? designHeight + vertSpace + Math.max(designHeight, imageHeight) : designHeight + vertSpace;
                    _svg.attr("class", layout.themeClass)
                        .attr("width", width + "mm")
                        .attr("height", height + "mm");
                    //UpdateSvgViewBox($svg, horizSpace);
                    UpdateSvgFront(_svg, horizSpace, vertSpace);
                    UpdateSvgBack(_svg, horizSpace);
                    UpdateSvgRight(_svg, horizSpace);
                    UpdateSvgLeft(_svg, horizSpace);
                    UpdateSvgGusset(_svg, vertSpace);
                    UpdateBagFeatures(_svg, designWidth, designHeight, horizSpace, vertSpace);
                    UpdateDesignImage(_svg, designWidth, designHeight, horizSpace, vertSpace);
                    UpdateFinishArea(_svg, designWidth, designHeight, horizSpace, vertSpace);
                    UpdateWhiteArea(_svg, designWidth, designHeight, horizSpace, vertSpace);
                }
            }

            function UpdateSvgFront(_svg, horizSpace, vertSpace) {
                //NOTE: The following variables unit is mm!
                let __center = pouch.front.width.value / 2;
                let __middle = pouch.front.height.value / 2;

                let _front = _svg.children(".side.front");

                //conditional elements//
                let $outlines = $(".side.front .face .outline");
                if (pouch.corners.included) {
                    let radius = pouch.corners.radius.value + pouch.corners.radius.unit;
                    if (pouch.gusset.type == GussetType.K) {
                        $outlines.filter(".upper").attr("rx", radius);
                        $outlines.filter(".lower").attr("rx", 0);
                    } else $outlines.attr("rx", radius);
                } else $outlines.attr("rx", 0);

                if (layout.verboseLabels) $(".verbosity").show();
                else $(".verbosity").hide();
                if (pouch.zipper.included) $(".side.front .zipper").show();
                else $(".side.front .zipper").hide();
                if (pouch.notch.included) $(".side.front .notch").show();
                else $(".side.front .notch").hide();
                if (pouch.zipper.facet == FacetPlacement.Front) {
                    if (pouch.zipper.type == ZipperType.EasyPull) {
                        $(".side.front .zipper .wishbone").show();
                        $(".side.front .zipper .straight").hide();
                    } else {
                        $(".side.front .zipper .wishbone").hide();
                        $(".side.front .zipper .straight").show();
                    }
                } else {
                    $(".side.front .zipper .straight").hide();
                    $(".side.front .zipper .wishbone").hide();
                    $(".side.front .zipper .offset").hide();
                }
                if (pouch.hanger.included) $(".side.front .hanger").show();
                else $(".side.front .hanger").hide();

                if (pouch.left.included || !pouch.gusset.included || pouch.gusset.type == GussetType.K) $(".side.front .seal .curve, .side.front .meridian").hide();
                else $(".side.front .seal .curve, .side.front .meridian").show();
                if (/*pouch.left.included ||*/ !pouch.gusset.included || pouch.gusset.type == GussetType.Rounded) $(".side.front .seal .k-corner, .side.front .meridian").hide();
                else $(".side.front .seal .k-corner, .side.front .meridian").show();

                if (pouch.hanger.included || pouch.seal.placement != Placement.Top) $(".side.front .seal text.top").hide();
                else $(".side.front .seal text.top").show();
                if (pouch.degasser.included) {
                    if (pouch.degasser.facet == FacetPlacement.Front) $(".side.front .degasser").show();
                    else $(".side.front .degasser").hide();
                } else $(".side.front .degasser").hide();
                if (pouch.seal.placement == Placement.Top) $(".side.front .seal text.bottom").hide();
                else $(".side.front .seal text.bottom").show();

                //front//
                _front.attr("x", horizSpace + "mm").attr("y", vertSpace + "mm");

                let _innerXOffset = pouch.seal.width.value + 9;
                let _innerYBottomOffset = -pouch.seal.width.value - 9;
                let _notchOffsetShift = layout.verboseLabels && pouch.notch.included ? 12.5 : 0;
                UpdateHeaderLabel(_front.find(".header"));
                UpdateFace(_front.find(".face"));
                UpdateHanger(_front.find(".hanger"));
                UpdateNotch(_front.find(".notch"));
                UpdateZipper(_front.find(".zipper"));
                UpdateDegasser(_front.find(".degasser"));
                UpdateSeal(_front.find(".seal"));
                UpdateMeridian(_front.find(".meridian"));

                //--------------------//

                function UpdateHeaderLabel(_header) {
                    let headerMargin = 17;
                    _header
                        .find(".label.background")
                        .attr("x", -headerMargin + "mm")
                        .attr("y", -25 + "mm")
                        .attr("width", pouch.front.width.value + headerMargin * 2 + "mm")
                        .attr("height", 7 + "mm");
                    _header
                        .find(".label.left")
                        .attr("x", -headerMargin + 4 + "mm")
                        .attr("y", -19 + "mm");
                    if (pouch.seal.placements.includes(Placement.Top)) {
                        _header
                            .find(".label.center")
                            .attr("x", __center - 15 + "mm")
                            .attr("y", -19 + "mm")
                            .text("(SEALED TOP)");
                    } else {
                        _header
                            .find(".label.center")
                            .attr("x", __center - 13 + "mm")
                            .attr("y", -19 + "mm")
                            .text("(OPENING)");
                    }
                    _header
                        .find(".label.right")
                        .attr("x", pouch.front.width.value + headerMargin - 18 + "mm")
                        .attr("y", -19 + "mm");
                }

                function UpdateFace(_face) {
                    _face
                        .find(".outline")
                        .attr("x", 0 + "mm")
                        .attr("y", 0 + "mm")
                        .attr("width", pouch.front.width.value + "mm")
                        .attr("height", pouch.front.height.value + "mm");
                    _face
                        .find(".clip.upper") //NOTE:clips have been padding with -1, +1, +2 because clipping is overzealous near the edge of the clip shape.
                        .attr("x", -1 + "mm")
                        .attr("y", -1 + "mm")
                        .attr("width", pouch.front.width.value + 2 + pouch.front.width.unit)
                        .attr("height", pouch.front.height.value / 2 + 1 + pouch.front.height.unit);
                    _face
                        .find(".clip.lower")
                        .attr("x", -1 + "mm")
                        .attr("y", pouch.front.height.value / 2 + pouch.front.height.unit)
                        .attr("width", pouch.front.width.value + 2 + pouch.front.width.unit)
                        .attr("height", pouch.front.height.value / 2 + 1 + pouch.front.height.unit);
                    UpdateFaceOuterHeightGuides(_face.find(".height.outer"));
                    UpdateFaceOuterWidthGuides(_face.find(".width.outer"));
                    UpdateFaceInnerHeightGuides(_face.find(".height.inner"));
                    UpdateFaceInnerWidthGuides(_face.find(".width.inner"));

                    //--------------------//

                    function UpdateFaceOuterHeightGuides(_outerHeight) {
                        _outerHeight
                            .find("text")
                            .attr("y", -7 + "mm")
                            .attr("x", -__middle + "mm")
                            .text(pouch.front.height.value + " mm" + (layout.verboseLabels ? " O.D." : ""));
                        _outerHeight
                            .find(".mark.top")
                            .attr("x1", -6 + "mm")
                            .attr("x2", -1 + "mm")
                            .attr("y1", 0 + "mm")
                            .attr("y2", 0 + "mm");
                        _outerHeight
                            .find(".arrow.top")
                            .attr("x", -3 + "mm")
                            .attr("y", 0 + "mm");
                        _outerHeight
                            .find("line.arrow")
                            .attr("x1", -3 + "mm")
                            .attr("x2", -3 + "mm")
                            .attr("y1", 2 + "mm")
                            .attr("y2", pouch.front.height.value - 2 + "mm");
                        _outerHeight
                            .find(".arrow.bottom")
                            .attr("x", -3 + "mm")
                            .attr("y", pouch.front.height.value + "mm");
                        _outerHeight
                            .find(".mark.bottom")
                            .attr("x1", -6 + "mm")
                            .attr("x2", -1 + "mm")
                            .attr("y1", pouch.front.height.value + "mm")
                            .attr("y2", pouch.front.height.value + "mm");
                    }

                    function UpdateFaceOuterWidthGuides(_outerWidth) {
                        _outerWidth
                            .find("text")
                            .attr("x", __center + "mm")
                            .attr("y", -7 + "mm")
                            .text(pouch.front.width.value + " mm" + (layout.verboseLabels ? " O.D." : ""));
                        _outerWidth
                            .find(".mark.left")
                            .attr("x1", 0 + "mm")
                            .attr("x2", 0 + "mm")
                            .attr("y1", -6 + "mm")
                            .attr("y2", -1 + "mm");
                        _outerWidth
                            .find(".arrow.left")
                            .attr("x", 0 + "mm")
                            .attr("y", -3 + "mm");
                        _outerWidth
                            .find("line.arrow")
                            .attr("x1", 2 + "mm")
                            .attr("x2", pouch.front.width.value - 2 + "mm")
                            .attr("y1", -3 + "mm")
                            .attr("y2", -3 + "mm");
                        _outerWidth
                            .find(".arrow.right")
                            .attr("x", pouch.front.width.value + "mm")
                            .attr("y", -3 + "mm");
                        _outerWidth
                            .find(".mark.right")
                            .attr("x1", pouch.front.width.value + "mm")
                            .attr("x2", pouch.front.width.value + "mm")
                            .attr("y1", -6 + "mm")
                            .attr("y2", -1 + "mm");
                    }

                    function UpdateFaceInnerHeightGuides(_innerHeight) {
                        let _innerYTopOffset = pouch.zipper.included ? pouch.zipper.offset.value + pouch.zipper.height.value / 2 : pouch.seal.width.value;

                        let _innerYHeight = pouch.front.height.value - _innerYTopOffset - pouch.seal.width.value;
                        _innerHeight
                            .find("text")
                            .attr("y", _innerXOffset + 1 + "mm")
                            .attr("x", -(_innerYTopOffset + (pouch.front.height.value - _innerYTopOffset + _innerYBottomOffset) / 2) + "mm")
                            .text(_innerYHeight + " mm I.D.");
                        _innerHeight
                            .find(".mark.top")
                            .attr("x1", pouch.seal.width.value + 1 + "mm")
                            .attr("x2", _innerXOffset + 6 + "mm")
                            .attr("y1", _innerYTopOffset + "mm")
                            .attr("y2", _innerYTopOffset + "mm");
                        _innerHeight
                            .find(".arrow.top")
                            .attr("x", _innerXOffset + 3 + "mm")
                            .attr("y", _innerYTopOffset + "mm");
                        _innerHeight
                            .find("line.arrow")
                            .attr("x1", _innerXOffset + 3 + "mm")
                            .attr("x2", _innerXOffset + 3 + "mm")
                            .attr("y1", _innerYTopOffset + 2 + "mm")
                            .attr("y2", pouch.front.height.value + _innerYBottomOffset - 5 + "mm");
                        _innerHeight
                            .find(".arrow.bottom")
                            .attr("x", _innerXOffset + 3 + "mm")
                            .attr("y", pouch.front.height.value + _innerYBottomOffset - 3 + "mm");
                        _innerHeight
                            .find(".mark.bottom")
                            .attr("x1", pouch.seal.width.value + 1 + "mm")
                            .attr("x2", _innerXOffset + 6 + "mm")
                            .attr("y1", pouch.front.height.value - pouch.seal.width.value - 1 + "mm")
                            .attr("y2", pouch.front.height.value + _innerYBottomOffset - 6 + "mm");
                        _innerHeight
                            .find(".mark.arrow")
                            .attr("x", pouch.seal.width.value + "mm")
                            .attr("y", pouch.front.height.value - pouch.seal.width.value + "mm");
                    }

                    function UpdateFaceInnerWidthGuides(_innerWidth) {
                        _innerWidth
                            .find("text")
                            .attr("x", __center + "mm")
                            .attr("y", pouch.front.height.value + _innerYBottomOffset - 5 + "mm")
                            .text(pouch.front.width.value - pouch.seal.width.value * 2 + " mm I.D.");
                        _innerWidth
                            .find(".mark.left")
                            .attr("x1", pouch.seal.width.value + 1 + "mm")
                            .attr("x2", _innerXOffset + 6 + "mm")
                            .attr("y1", pouch.front.height.value - pouch.seal.width.value - 1 + "mm")
                            .attr("y2", pouch.front.height.value + _innerYBottomOffset - 6 + "mm");
                        _innerWidth
                            .find(".arrow.left")
                            .attr("x", _innerXOffset + 3 + "mm")
                            .attr("y", pouch.front.height.value + _innerYBottomOffset - 3 + "mm");
                        _innerWidth
                            .find("line.arrow")
                            .attr("x1", _innerXOffset + 5 + "mm")
                            .attr("x2", pouch.front.width.value - pouch.seal.width.value - 2 + "mm")
                            .attr("y1", pouch.front.height.value + _innerYBottomOffset - 3 + "mm")
                            .attr("y2", pouch.front.height.value + _innerYBottomOffset - 3 + "mm");
                        _innerWidth
                            .find(".arrow.right")
                            .attr("x", pouch.front.width.value - pouch.seal.width.value + "mm")
                            .attr("y", pouch.front.height.value + _innerYBottomOffset - 3 + "mm");
                        _innerWidth
                            .find(".mark.right")
                            .attr("x1", pouch.front.width.value - pouch.seal.width.value + "mm")
                            .attr("x2", pouch.front.width.value - pouch.seal.width.value + "mm")
                            .attr("y1", pouch.front.height.value + _innerYBottomOffset - 6 + "mm")
                            .attr("y2", pouch.front.height.value - pouch.seal.width.value - 1 + "mm");
                    }
                }

                function UpdateHanger(_hanger) {
                    _hanger
                        .find(".hole")
                        .attr("cx", __center + "mm")
                        .attr("cy", pouch.hanger.offset.value + "mm")
                        .attr("r", pouch.hanger.height.value / 2 + "mm");
                    let _hangerOffset = _hanger.find(".offset");
                    _hangerOffset
                        .find("text.value")
                        .attr("x", __center + pouch.hanger.height.value / 2 + 5.5 + "mm")
                        .attr("y", pouch.hanger.offset.value / 2 + 1 + "mm")
                        .text(pouch.hanger.offset.value + " mm");
                    _hangerOffset
                        .find(".arrow.top")
                        .attr("x", __center + pouch.hanger.height.value / 2 + 3 + "mm")
                        .attr("y", 0 + "mm");
                    _hangerOffset
                        .find("line.arrow")
                        .attr("x1", __center + pouch.hanger.height.value / 2 + 3 + "mm")
                        .attr("x2", __center + pouch.hanger.height.value / 2 + 3 + "mm")
                        .attr("y1", 2 + "mm")
                        .attr("y2", pouch.hanger.offset.value - 2 + "mm");
                    _hangerOffset
                        .find(".arrow.bottom")
                        .attr("x", __center + pouch.hanger.height.value / 2 + 3 + "mm")
                        .attr("y", pouch.hanger.offset.value + "mm");
                    _hangerOffset
                        .find(".mark.bottom")
                        .attr("x1", __center + pouch.hanger.height.value / 2 + 1 + "mm")
                        .attr("x2", __center + pouch.hanger.height.value / 2 + 6 + "mm")
                        .attr("y1", pouch.hanger.offset.value + "mm")
                        .attr("y2", pouch.hanger.offset.value + "mm");
                    _hangerOffset
                        .find("text.type")
                        .attr("x", __center + pouch.hanger.height.value / 2 + 7 + "mm")
                        .attr("y", pouch.hanger.offset.value + 1 + "mm");
                }

                function UpdateNotch(_notch) {
                    _notch
                        .find(".cut.left")
                        .attr("x", 0 + "mm")
                        .attr("y", pouch.notch.offset.value + "mm");
                    _notch
                        .find(".cut.right")
                        .attr("x", pouch.front.width.value + "mm")
                        .attr("y", pouch.notch.offset.value + "mm");
                    let _notchOffset = _notch.find(".offset");
                    _notchOffset
                        .find("text.value")
                        .attr("y", -pouch.front.width.value - 5 - _notchOffsetShift + "mm")
                        .attr("x", pouch.notch.offset.value / 2 - 5.5 + "mm")
                        .text(pouch.notch.offset.value + " mm");
                    _notchOffset
                        .find(".mark.top")
                        .attr("x1", pouch.front.width.value + 1 + "mm")
                        .attr("x2", pouch.front.width.value + 6 + _notchOffsetShift + "mm")
                        .attr("y1", 0 + "mm")
                        .attr("y2", 0 + "mm");
                    _notchOffset
                        .find(".arrow.top")
                        .attr("x", pouch.front.width.value + 3 + _notchOffsetShift + "mm")
                        .attr("y", 0 + "mm");
                    _notchOffset
                        .find("line.arrow")
                        .attr("x1", pouch.front.width.value + 3 + _notchOffsetShift + "mm")
                        .attr("x2", pouch.front.width.value + 3 + _notchOffsetShift + "mm")
                        .attr("y1", 2 + "mm")
                        .attr("y2", pouch.notch.offset.value - 2 + "mm");
                    _notchOffset
                        .find(".arrow.bottom")
                        .attr("x", pouch.front.width.value + 3 + _notchOffsetShift + "mm")
                        .attr("y", pouch.notch.offset.value + "mm");
                    _notchOffset
                        .find(".mark.bottom")
                        .attr("x1", pouch.front.width.value + 1 + "mm")
                        .attr("x2", pouch.front.width.value + 6 + _notchOffsetShift + "mm")
                        .attr("y1", pouch.notch.offset.value + "mm")
                        .attr("y2", pouch.notch.offset.value + "mm");
                    _notchOffset
                        .find("text.type")
                        .attr("x", pouch.front.width.value + 3 + "mm")
                        .attr("y", pouch.notch.offset.value / 2 - 1 + "mm");
                    _notchOffset
                        .find(".type tspan.lower")
                        .attr("x", pouch.front.width.value + 3 + "mm")
                        .attr("dy", 3 + "mm");
                }

                function UpdateZipper(_zipper) {
                    let _zipperOffsetShift = _notchOffsetShift + (pouch.notch.included ? 5 : 0);
                    let _straight = _zipper.find(".straight");
                    _straight
                        .find(".outline")
                        .attr("x", 0 + "mm")
                        .attr("y", pouch.zipper.offset.value - pouch.zipper.height.value / 2 + "mm")
                        .attr("width", pouch.front.width.value + "mm")
                        .attr("height", pouch.zipper.height.value + "mm");
                    _straight
                        .find(".inner")
                        .attr("x", 0 + "mm")
                        .attr("y", pouch.zipper.offset.value - pouch.zipper.height.value / 6 + "mm")
                        .attr("width", pouch.front.width.value + "mm")
                        .attr("height", pouch.zipper.height.value / 3 + "mm");
                    let _wishbone = _zipper.find(".wishbone");
                    let wishboneX = 3;
                    _wishbone
                        .find(".clip.top")
                        .attr("x", wishboneX - 0.2 + "mm")
                        .attr("y", pouch.zipper.offset.value - 14.5 + "mm");
                    _wishbone
                        .find(".clip.middle")
                        .attr("x", wishboneX + 6.85 + "mm")
                        .attr("y", pouch.zipper.offset.value - 9.5 + "mm");
                    _wishbone
                        .find(".clip.bottom")
                        .attr("x", wishboneX - 0.2 + "mm")
                        .attr("y", pouch.zipper.offset.value + 2.5 + "mm");
                    _wishbone
                        .find(".tear.upper.top")
                        .attr("cx", wishboneX + 3.5 + "mm")
                        .attr("cy", pouch.zipper.offset.value - 10.5 + "mm");
                    _wishbone
                        .find(".tear.upper.bottom")
                        .attr("cx", wishboneX + 10 + "mm")
                        .attr("cy", pouch.zipper.offset.value - 9.5 + "mm");
                    _wishbone
                        .find(".tear.lower.top")
                        .attr("cx", wishboneX + 10 + "mm")
                        .attr("cy", pouch.zipper.offset.value + 1 + "mm");
                    _wishbone
                        .find(".tear.lower.bottom")
                        .attr("cx", wishboneX + 3.5 + "mm")
                        .attr("cy", pouch.zipper.offset.value + 2.5 + "mm");
                    _wishbone.find(".clip.heated").attr("height", pouch.zipper.offset.value + 40 + "mm");
                    _wishbone
                        .find(".heated.vertical")
                        .attr("x", -10 + "mm")
                        .attr("y", -10 + "mm")
                        .attr("width", 25.5 + "mm")
                        .attr("height", pouch.zipper.offset.value + 41.5 + "mm");
                    _wishbone
                        .find(".heated.horizontal")
                        .attr("x1", 0 + "mm")
                        .attr("x2", pouch.front.width.value + "mm")
                        .attr("y1", pouch.zipper.offset.value + 17.5 + "mm")
                        .attr("y2", pouch.zipper.offset.value + 17.5 + "mm");
                    _wishbone
                        .find(".outline")
                        .attr("x", 3 + "mm")
                        .attr("y", pouch.zipper.offset.value - pouch.zipper.height.value / 2 + "mm")
                        .attr("width", pouch.front.width.value - 3 + "mm")
                        .attr("height", pouch.zipper.height.value + "mm");
                    _wishbone
                        .find(".inner")
                        .attr("x", 3 + "mm")
                        .attr("y", pouch.zipper.offset.value - pouch.zipper.height.value / 6 + "mm")
                        .attr("width", pouch.front.width.value - 3 + "mm")
                        .attr("height", pouch.zipper.height.value / 3 + "mm");
                    let _zipperOffset = _zipper.find(".offset");
                    _zipperOffset
                        .find("text.value")
                        .attr("x", pouch.zipper.offset.value / 2 - 5.5 + "mm")
                        .attr("y", -pouch.front.width.value - 6 - _zipperOffsetShift + "mm")
                        .text(pouch.zipper.offset.value + " mm");
                    _zipperOffset
                        .find(".mark.top")
                        .attr("x1", pouch.front.width.value + 1 + "mm")
                        .attr("x2", pouch.front.width.value + 7 + _zipperOffsetShift + "mm")
                        .attr("y1", 0 + "mm")
                        .attr("y2", 0 + "mm");
                    _zipperOffset
                        .find(".arrow.top")
                        .attr("x", pouch.front.width.value + 4 + _zipperOffsetShift + "mm")
                        .attr("y", 0 + "mm");
                    _zipperOffset
                        .find("line.arrow")
                        .attr("x1", pouch.front.width.value + 4 + _zipperOffsetShift + "mm")
                        .attr("x2", pouch.front.width.value + 4 + _zipperOffsetShift + "mm")
                        .attr("y1", 2 + "mm")
                        .attr("y2", pouch.zipper.offset.value - 2 + "mm");
                    _zipperOffset
                        .find(".arrow.bottom")
                        .attr("x", pouch.front.width.value + 4 + _zipperOffsetShift + "mm")
                        .attr("y", pouch.zipper.offset.value + "mm");
                    _zipperOffset
                        .find(".mark.bottom")
                        .attr("x1", pouch.front.width.value + 1 + "mm")
                        .attr("x2", pouch.front.width.value + 7 + _zipperOffsetShift + "mm")
                        .attr("y1", pouch.zipper.offset.value + "mm")
                        .attr("y2", pouch.zipper.offset.value + "mm");
                    _zipperOffset
                        .find("text.type")
                        .attr("x", pouch.front.width.value + 10 + _zipperOffsetShift + "mm")
                        .attr("y", pouch.zipper.offset.value / 2 - 1 + "mm");
                    _zipperOffset.find(".type tspan.upper").text(pouch.zipper.type == ZipperType.Standard ? "Standard Zipper" : pouch.zipper.type == ZipperType.EasyPull ? "Easy-Pull Zipper" : "Child-Resistant Zipper");
                    _zipperOffset
                        .find(".type tspan.lower")
                        .attr("x", pouch.front.width.value + 10 + _zipperOffsetShift + "mm")
                        .attr("dy", 3 + "mm")
                        .text(pouch.zipper.type == ZipperType.ChildResistant ? "" : "(not child-resistant)");
                }

                function UpdateDegasser(_degasser) {
                    _degasser
                        .find("circle.outer")
                        .attr("cx", __center + "mm")
                        .attr("cy", pouch.degasser.offset.value + "mm")
                        .attr("r", pouch.degasser.height.value / 2 + "mm");
                    _degasser
                        .find("circle.inner")
                        .attr("cx", __center + "mm")
                        .attr("cy", pouch.degasser.offset.value + "mm")
                        .attr("r", 1.5 + "mm");
                    let _degasserOffset = _degasser.find(".offset");
                    _degasserOffset
                        .find("text.value")
                        .attr("y", __center - 6 + "mm")
                        .attr("x", -(pouch.degasser.offset.value * 0.95 - 5.5) + "mm")
                        .text(pouch.degasser.offset.value + " mm");
                    _degasserOffset
                        .find(".mark.top")
                        .attr("x1", __center - 2.5 + "mm")
                        .attr("x2", __center - 7.5 + "mm")
                        .attr("y1", 0 + "mm")
                        .attr("y2", 0 + "mm");
                    _degasserOffset
                        .find(".arrow.top")
                        .attr("x", __center - 4.5 + "mm")
                        .attr("y", 0 + "mm");
                    _degasserOffset
                        .find("line.arrow")
                        .attr("x1", __center - 4.5 + "mm")
                        .attr("x2", __center - 4.5 + "mm")
                        .attr("y1", 2 + "mm")
                        .attr("y2", pouch.degasser.offset.value - 2 + "mm");
                    _degasserOffset
                        .find(".arrow.bottom")
                        .attr("x", __center - 4.5 + "mm")
                        .attr("y", 0 + pouch.degasser.offset.value + "mm");
                    _degasserOffset
                        .find(".mark.bottom")
                        .attr("x1", __center - 2.5 + "mm")
                        .attr("x2", __center - 7.5 + "mm")
                        .attr("y1", 0 + pouch.degasser.offset.value + "mm")
                        .attr("y2", 0 + pouch.degasser.offset.value + "mm");
                    _degasserOffset
                        .find("text.type")
                        .attr("x", __center - 20.5 + "mm")
                        .attr("y", pouch.degasser.offset.value - 0.5 + "mm");
                    _degasserOffset
                        .find(".type tspan.lower")
                        .attr("x", __center - 19.7 + "mm")
                        .attr("dy", 3 + "mm");
                }

                function UpdateSeal(_seal) {
                    let x = 0,
                        y = 0,
                        width = pouch.front.width.value,
                        height = pouch.front.height.value;
                    if (pouch.seal.placements.includes(Placement.Top)) {
                        y += pouch.seal.width.value;
                        height -= pouch.seal.width.value;
                    }
                    if (pouch.seal.placements.includes(Placement.Bottom)) {
                        height -= pouch.seal.width.value;
                    }
                    if (pouch.seal.placements.includes(Placement.Left)) {
                        x += pouch.seal.width.value;
                        width -= pouch.seal.width.value;
                    }
                    if (pouch.seal.placements.includes(Placement.Right)) {
                        width -= pouch.seal.width.value;
                    }
                    _seal
                        .find(".outline")
                        .attr("x", x + "mm")
                        .attr("y", y + "mm")
                        .attr("width", width + "mm")
                        .attr("height", height + "mm");
                    _seal
                        .find(".curve")
                        .attr("cx", __center + "mm")
                        .attr("cy", pouch.front.height.value - pouch.gusset.depth.value / 2 + "mm")
                        .attr("rx", pouch.front.width.value / 2 - pouch.seal.width.value + "mm")
                        .attr("ry", pouch.gusset.depth.value / 2 - pouch.seal.width.value + "mm");
                    _seal
                        .find(".clip")
                        .attr("x", 0 + "mm")
                        .attr("y", pouch.front.height.value - pouch.gusset.depth.value / 2 + "mm")
                        .attr("width", pouch.front.width.value + "mm")
                        .attr("height", pouch.gusset.depth.value / 2 + "mm");
                    _seal
                        .find(".k-corner.left")
                        .attr("x1", x + "mm")
                        .attr("x2", pouch.gusset.depth.value / 2 + "mm")
                        .attr("y1", pouch.front.height.value - pouch.gusset.depth.value / 2 + "mm")
                        .attr("y2", pouch.front.height.value + "mm");
                    _seal
                        .find(".k-corner.right")
                        .attr("x1", pouch.front.width.value - pouch.seal.width.value + "mm")
                        .attr("x2", pouch.front.width.value - pouch.gusset.depth.value / 2 + "mm")
                        .attr("y1", pouch.front.height.value - pouch.gusset.depth.value / 2 + "mm")
                        .attr("y2", pouch.front.height.value + "mm");
                    _seal
                        .find("text.top")
                        .attr("x", __center + "mm")
                        .attr("y", 0.9 + pouch.seal.width.value / 2 + "mm")
                        .text(pouch.seal.width.value + " mm" + (layout.verboseLabels ? " Seal" : ""));
                    _seal
                        .find("text.right")
                        .attr("x", -__middle + "mm")
                        .attr("y", 0.9 + pouch.front.width.value - pouch.seal.width.value / 2 + "mm")
                        .text(pouch.seal.width.value + " mm" + (layout.verboseLabels ? " Seal" : ""));
                    _seal
                        .find("text.bottom")
                        .attr("x", __center + "mm")
                        .attr("y", 0.9 + pouch.front.height.value - pouch.seal.width.value / 2 + "mm")
                        .text(pouch.seal.width.value + " mm" + (layout.verboseLabels ? " Seal" : ""));
                    if (pouch.seal.placements.includes(Placement.Bottom)) {
                        _seal.find("text.bottom").remove();
                    }
                    _seal
                        .find("text.left")
                        .attr("x", -__middle + "mm")
                        .attr("y", 0.9 + pouch.seal.width.value / 2 + "mm")
                        .text(pouch.seal.width.value + " mm" + (layout.verboseLabels ? " Seal" : ""));
                }

                function UpdateMeridian(_meridian) {
                    _meridian
                        .find(".divide")
                        .attr("x1", 0 + "mm")
                        .attr("x2", pouch.front.width.value + "mm")
                        .attr("y1", pouch.front.height.value - pouch.gusset.depth.value / 2 + "mm")
                        .attr("y2", pouch.front.height.value - pouch.gusset.depth.value / 2 + "mm");
                    let _meridianOffset = _meridian.find(".offset");
                    _meridianOffset
                        .find("text")
                        .attr("y", -(pouch.front.width.value + 5) + "mm")
                        .attr("x", pouch.front.height.value - pouch.gusset.depth.value / 4 - 5.5 + "mm")
                        .text(pouch.gusset.depth.value / 2 + " mm");
                    _meridianOffset
                        .find(".mark.top")
                        .attr("x1", pouch.front.width.value + 1 + "mm")
                        .attr("x2", pouch.front.width.value + 6 + "mm")
                        .attr("y1", pouch.front.height.value - pouch.gusset.depth.value / 2 + "mm")
                        .attr("y2", pouch.front.height.value - pouch.gusset.depth.value / 2 + "mm");
                    _meridianOffset
                        .find(".arrow.top")
                        .attr("x", pouch.front.width.value + 3 + "mm")
                        .attr("y", pouch.front.height.value - pouch.gusset.depth.value / 2 + "mm");
                    _meridianOffset
                        .find("line.arrow")
                        .attr("x1", pouch.front.width.value + 3 + "mm")
                        .attr("x2", pouch.front.width.value + 3 + "mm")
                        .attr("y1", pouch.front.height.value - pouch.gusset.depth.value / 2 + 2 + "mm")
                        .attr("y2", pouch.front.height.value - 2 + "mm");
                    _meridianOffset
                        .find(".arrow.bottom")
                        .attr("x", pouch.front.width.value + 3 + "mm")
                        .attr("y", pouch.front.height.value + "mm");
                    _meridianOffset
                        .find(".mark.bottom")
                        .attr("x1", pouch.front.width.value + 1 + "mm")
                        .attr("x2", pouch.front.width.value + 6 + "mm")
                        .attr("y1", pouch.front.height.value + "mm")
                        .attr("y2", pouch.front.height.value + "mm");
                }
            }

            // function CreateHorizontalBezierArc(x1, x2, y, radius) {
            //     return `M ${x1} ${y} C ${x1} ${y + radius * 1.32536445942915653}, ${x2} ${y + radius * 1.32536445942915653}, ${x2} ${y}`;
            // }

            function UpdateSvgBack(_svg, horizSpace) {
                let __left = pouch.right.included ? horizSpace * 3 + pouch.front.width.value + pouch.right.width.value : horizSpace * 2 + pouch.front.width.value;
                let _front = _svg.children(".side.front");
                let _old = _svg.children(".side.back");
                let _new = _front.clone();
                _new.toggleClass("front back");
                _new.find(".header .label.left").text("BACK");

                _new.find(".zipper .wishbone clipPath")._elements.forEach((el) => {
                    el.id = el.id + "_back"; //NOTE:  could grab by id attribute and update all id instead of just clipPath elements
                });
                _new.find(".zipper .wishbone :not(clipPath)")._elements.forEach((el) => {
                    let clipPath = el.getAttribute("clip-path");
                    if (clipPath) {
                        el.removeAttribute("clip-path");
                        el.setAttribute("clip-path", clipPath.replace(/\)/g, "_back)"));
                    }
                });
                if (pouch.zipper.type == ZipperType.EasyPull) {
                    if (pouch.zipper.facet == FacetPlacement.Front) _new.find(".zipper").remove();
                    else {
                        _new.find(".zipper .straight").remove();
                        _new.find(".zipper .wishbone").attr("style", "");
                        _new.find(".zipper .offset").attr("style", "");
                    }
                }
                if (pouch.degasser.included) {
                    if (pouch.degasser.facet == FacetPlacement.Front) _new.find(".degasser").remove();
                    else _new.find(".degasser").attr("style", ""); //remove display:none;
                } else _new.find(".degasser").remove();
                if (pouch.degasser.included) _new.find(".degasser").attr("style", ""); //remove display:none;
                //_new.find(".face .height.inner, .face .width.inner").remove();
                _new.attr("x", __left + "mm");
                _old.remove();
                _new.appendTo(_svg);
            }

            function UpdateSvgLeft(_svg, horizSpace) {
                let __left = horizSpace * 4 + pouch.front.width.value * 2 + pouch.right.width.value;
                let _right = _svg.children(".side.right");
                let _old = _svg.children(".side.left");
                if (pouch.left.included) {
                    let _new = _right.clone();
                    _new.toggleClass("right left");
                    _new.find(".header .label.left").text("LEFT");
                    _new.find(".header .label.center").text("");
                    _new.attr("x", __left + "mm");
                    _new.appendTo(_svg);
                }
                _old.remove();
            }

            function UpdateSvgRight(_svg, horizSpace) {
                let __left = horizSpace * 2 + pouch.front.width.value;
                let _front = _svg.children(".side.front");
                let _old = _svg.children(".side.right");
                if (pouch.left.included) {
                    let _new = _front.clone();
                    _new.toggleClass("front right");

                    //header label//
                    let headerMargin = 17;
                    _new.find(".header .label.background").attr("width", pouch.right.width.value + headerMargin * 2 + "mm");
                    _new.find(".header .label.left").text("RIGHT");
                    _new.find(".header .label.center").remove();
                    _new.find(".header .label.right").attr("x", pouch.right.width.value + headerMargin - 18 + "mm");

                    //face//
                    _new.find(".face .outline").attr("width", pouch.left.width.value + "mm");

                    //face width guides//
                    _new.find(".face .width.outer text")
                        .attr("x", pouch.right.width.value / 2 + "mm")
                        .text(pouch.right.width.value + " mm" + (layout.verboseLabels ? " O.D." : ""));
                    _new.find(".face .width.outer line.arrow").attr("x2", pouch.right.width.value - 2 + "mm");
                    _new.find(".face .width.outer .arrow.right").attr("x", pouch.right.width.value + "mm");
                    _new.find(".face .width.outer .mark.right")
                        .attr("x1", pouch.right.width.value + "mm")
                        .attr("x2", pouch.right.width.value + "mm");
                    _new.find(".face .height.inner, .face .width.inner").remove();

                    //seal//
                    _new.find(".seal .outline").attr("width", pouch.right.width.value - pouch.seal.width.value * 2 + "mm");
                    _new.find(".seal text.top")
                        .attr("x", pouch.right.width.value / 2 + "mm")
                        .attr("style", pouch.seal.placement == Placement.Top ? "" : "display:none");
                    _new.find(".seal text.right").attr("y", 0.9 + pouch.right.width.value - pouch.seal.width.value / 2 + "mm");
                    _new.find(".seal text.bottom").attr("x", pouch.right.width.value / 2 + "mm");

                    _new.find(".hanger").remove();
                    _new.find(".notch").remove();
                    _new.find(".zipper").remove();
                    _new.find(".degasser").remove();
                    _new.attr("x", __left + "mm");
                    _new.appendTo(_svg);
                }
                _old.remove();
            }

            function UpdateSvgGusset(_svg, vertSpace) {
                let __top = pouch.front.height.value + vertSpace * 2;
                let _front = _svg.children(".side.front");
                let _old = _svg.children(".side.gusset");
                if (pouch.gusset.included) {
                    let _new = _front.clone();
                    _new.toggleClass("front gusset");

                    //header label//
                    let headerMargin = 17;
                    _new.find(".header .label.background"); //.attr("width", pouch.right.width.value + headerMargin * 2 + "mm");
                    _new.find(".header .label.left").text("BOTTOM");
                    _new.find(".header .label.center").remove();
                    _new.find(".header .label.right")
                        .attr("x", pouch.front.width.value + headerMargin - 33 + "mm")
                        .text("GUSSET");

                    //face//
                    _new.find(".face .outline.upper").attr("clip-path", "");
                    _new.find(".face .outline.lower").remove();
                    _new.find(".face .outline").attr("height", pouch.gusset.depth.value + "mm");
                    if (pouch.gusset.type == GussetType.K) {
                        _new.find(".face .outline").attr("rx", 0);
                    }

                    //face width guides//
                    _new.find(".face .width.outer").remove();

                    //face height guides//
                    _new.find(".face .height.outer text")
                        .attr("x", -(pouch.gusset.depth.value / 2 + 7) + "mm")
                        .text(pouch.gusset.depth.value + " mm" + (layout.verboseLabels ? " O.D." : ""));
                    _new.find(".face .height.outer line.arrow").attr("y2", pouch.gusset.depth.value - 2 + "mm");
                    _new.find(".face .height.outer .arrow.bottom").attr("y", pouch.gusset.depth.value + "mm");
                    _new.find(".face .height.outer .mark.bottom")
                        .attr("y1", pouch.gusset.depth.value + "mm")
                        .attr("y2", pouch.gusset.depth.value + "mm");
                    _new.find(".face .height.inner, .face .width.inner").remove();

                    //seal//
                    _new.find(".seal .k-corner").remove();
                    if (pouch.gusset.type == GussetType.Rounded) {
                        _new.find(".seal .curve")
                            .attr("cy", pouch.gusset.depth.value / 2 + "mm")
                            .attr("clip-path", "");
                        _new.find(".seal .outline")
                            .attr("y", pouch.seal.width.value + "mm")
                            .attr("height", pouch.gusset.depth.value - pouch.seal.width.value * 2 + "mm");
                        _new.find(".seal text.top").attr("style", "");
                        _new.find(".seal text.right").attr("x", -pouch.gusset.depth.value / 2 + "mm");
                        _new.find(".seal text.bottom")
                            .attr("y", 0.9 + pouch.gusset.depth.value - pouch.seal.width.value / 2 + "mm")
                            .attr("style", "");
                        _new.find(".seal text.left").attr("x", -pouch.gusset.depth.value / 2 + "mm");
                    } else {
                        _new.find(".seal .outline").remove();
                        _new.find(".seal text.right").remove();
                        _new.find(".seal text.left").remove();
                        _new.find(".seal text.bottom").remove();
                    }

                    //meridian//
                    _new.find(".meridian .divide")
                        .attr("y1", pouch.gusset.depth.value / 2 + "mm")
                        .attr("y2", pouch.gusset.depth.value / 2 + "mm");
                    _new.find(".meridian .offset text")
                        .attr("y", -(pouch.front.width.value + 5) + "mm")
                        .attr("x", pouch.gusset.depth.value / 4 - 4 + "mm")
                        .text(pouch.gusset.depth.value / 2 + " mm");
                    _new.find(".meridian .offset .mark.top")
                        .attr("y1", pouch.gusset.depth.value / 2 + "mm")
                        .attr("y2", pouch.gusset.depth.value / 2 + "mm");
                    _new.find(".meridian .offset .arrow.top").attr("y", 0 + "mm");
                    _new.find(".meridian .offset line.arrow")
                        .attr("y1", 2 + "mm")
                        .attr("y2", pouch.gusset.depth.value / 2 - 2 + "mm");
                    _new.find(".meridian .offset .arrow.bottom").attr("y", pouch.gusset.depth.value / 2 + "mm");
                    _new.find(".meridian .offset .mark.bottom")
                        .attr("y1", 0 + "mm")
                        .attr("y2", 0 + "mm");
                    _new.find(".meridian").attr("style", ""); //show

                    _new.find(".hanger").remove();
                    _new.find(".notch").remove();
                    _new.find(".zipper").remove();
                    _new.find(".degasser").remove();
                    _new.attr("y", __top + "mm");
                    _new.appendTo(_svg);
                }
                _old.remove();
            }

            function UpdateBagFeatures(_svg, designWidth, designHeight, horizSpace, vertSpace) {
                let _features = _svg.find(".area.features");
                _features.attr("x", designWidth + horizSpace + "mm").attr("y", vertSpace + "mm");
                _features.find(".label.outer").text("Outer Size (h x w" + (pouch.gusset.included ? " x d):" : "):"));
                _features.find(".value.outer").text(`${pouch.front.height.value} x ${pouch.front.width.value} ${pouch.gusset.included ? " x " + pouch.gusset.depth.value : ""} mm`);
                _features.find(".label.inner").text("Inner Size (h x w" + (pouch.gusset.included ? " x d):" : "):"));
                let innerHeight = pouch.zipper.included ? pouch.front.height.value - pouch.seal.width.value - pouch.zipper.offset.value - pouch.zipper.height.value / 2 : pouch.front.height.value - pouch.seal.width.value * 2;
                _features.find(".value.inner").text(`${innerHeight} x ${pouch.front.width.value - pouch.seal.width.value * 2} ${pouch.gusset.included ? " x " + (pouch.gusset.depth.value - pouch.seal.width.value * 2) : ""} mm`);
                _features.find(".value.seal").text(pouch.seal.width.value + " mm");
                _features.find(".value.finish").text(layout.finish);
                _features.find(".label.hanger").attr("class", "label hanger fill medium small " + (pouch.hanger.included ? "green" : "red"));
                _features.find(".icon.hanger").attr("class", "icon hanger fill medium small " + (pouch.hanger.included ? "green" : "red"));
                _features.find(".icon.hanger path").attr("d", pouch.hanger.included ? svgCheck : svgX);
                _features.find(".label.notch").attr("class", "label notch fill medium small " + (pouch.notch.included ? "green" : "red"));
                _features.find(".icon.notch").attr("class", "icon notch fill medium small " + (pouch.notch.included ? "green" : "red"));
                _features.find(".icon.notch path").attr("d", pouch.notch.included ? svgCheck : svgX);
                _features.find(".label.degasser").attr("class", "label degasser fill medium small " + (pouch.degasser.included ? "green" : "red"));
                _features.find(".icon.degasser").attr("class", "icon degasser fill medium small " + (pouch.degasser.included ? "green" : "red"));
                _features.find(".icon.degasser path").attr("d", pouch.degasser.included ? svgCheck : svgX);
                _features.find(".label.zipper.standard").attr("class", "label zipper standard fill medium small " + (pouch.zipper.included && pouch.zipper.type == ZipperType.Standard ? "green" : "red"));
                _features.find(".icon.zipper.standard").attr("class", "icon zipper standard fill medium small " + (pouch.zipper.included && pouch.zipper.type == ZipperType.Standard ? "green" : "red"));
                _features.find(".icon.zipper.standard path").attr("d", pouch.zipper.included && pouch.zipper.type == ZipperType.Standard ? svgCheck : svgX);
                _features.find(".label.zipper.safety").attr("class", "label zipper safety fill medium small " + (pouch.zipper.included && pouch.zipper.type == ZipperType.ChildResistant ? "green" : "red"));
                _features.find(".icon.zipper.safety").attr("class", "icon zipper safety fill medium small " + (pouch.zipper.included && pouch.zipper.type == ZipperType.ChildResistant ? "green" : "red"));
                _features.find(".icon.zipper.safety path").attr("d", pouch.zipper.included && pouch.zipper.type == ZipperType.ChildResistant ? svgCheck : svgX);
                _features.find(".label.zipper.wishbone").attr("class", "label zipper wishbone fill medium small " + (pouch.zipper.included && pouch.zipper.type == ZipperType.EasyPull ? "green" : "red"));
                _features.find(".icon.zipper.wishbone").attr("class", "icon zipper wishbone fill medium small " + (pouch.zipper.included && pouch.zipper.type == ZipperType.EasyPull ? "green" : "red"));
                _features.find(".icon.zipper.wishbone path").attr("d", pouch.zipper.included && pouch.zipper.type == ZipperType.EasyPull ? svgCheck : svgX);
                _features.attr("style", "");
                //_features.attr("style", "display:none");
            }

            function UpdateDesignImage(_svg, designWidth, designHeight, horizSpace, vertSpace) {
                let featuresWidth = 71;
                let left = layout.verboseLabels ? designWidth + horizSpace + featuresWidth + horizSpace : designWidth + horizSpace;
                _svg.find(".area.design")
                    .attr("x", left + "mm")
                    .attr("y", 13 + "mm");
            }

            function UpdateFinishArea(_svg, designWidth, designHeight, horizSpace, vertSpace) {
                let _old = _svg.find(".area.finish");
                if (layout.inkingDetails) {
                    let top = designHeight < 287 ? 287 : designHeight; // accomodates design image
                    let _new = _svg.clone();
                    _new.find(".area").remove(); //remove old nested areas
                    _new.attr("class", "area finish finish-" + layout.finish);
                    _new.attr("y", top + "mm");
                    _new.find(".side .header").remove();
                    _new.find(".side .hanger").remove();
                    _new.find(".side .notch").remove();
                    _new.find(".side .zipper").remove();
                    _new.find(".side .degasser").remove();
                    _new.find(".side .seal").remove();
                    _new.find(".side .meridian").remove();
                    _new.find(".side .face .outer").remove();
                    _new.find(".side .face .inner").remove();
                    _new.create("text")
                        .attr("class", "header fill dark medium small")
                        .attr("x", 44 + "mm")
                        .attr("y", 31 + "mm")
                        .text("BAG FINISH");
                    _new.appendTo(_svg);
                }
                _old.remove();
            }

            function UpdateWhiteArea(_svg, designWidth, designHeight, horizSpace, vertSpace) {
                let _old = _svg.find(".area.white");
                if (layout.inkingDetails) {
                    let _new = _svg.find(".area.finish").clone();
                    _new.attr("class", "area white");
                    _new.attr("x", designWidth + "mm");
                    _new.find("text.header").text("LOCATION OF WHITE");
                    _new.appendTo(_svg);
                }
                _old.remove();
            }

            //////////////Downloader///////////////////////////
            function downloadSvg(filename, svgElement) {
                let el = document.createElement("a");
                removeForAdobeIllustrator(svgElement);
                el.setAttribute("href", "data:image/svg+xml;charset=utf-8," + encodeURIComponent(svgElement.outerHTML));
                restoreForAdobeIllustrator(svgElement);
                el.setAttribute("download", filename);
                el.style.display = "none";
                document.body.appendChild(el);
                el.click();
                document.body.removeChild(el);
            }

            $("#Download").on("click", function () {
                downloadSvg("pouch-dieline.svg", $("aside>svg")[0]);
            });

            function removeForAdobeIllustrator(svgElement) {
                //nuke all display:none elements//
                layout.freeze();
                let matches = svgElement.querySelectorAll('[style~="display:"]');
                matches = [].slice.call(matches).filter((x) => x.style.display == "none");
                for (let key in matches) {
                    matches[key].remove();
                }
            }

            function restoreForAdobeIllustrator(svgElement) {
                //nuke and recreate entire svg//
                svgElement.remove();
                CreateSvg();
                layout.unfreeze();
                UpdateSvg();
            }
        </script>
    </body>
</html>
