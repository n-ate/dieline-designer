<html>
    <head>
        <title>Demo</title>
        <style type="text/css">
            body {
                max-width: 1450px;
                margin: 2em auto 0;
            }
            main {
            }
            aside {
            }
            /* aside > svg {
                widows: 100%;
            } */
            .flex-form {
                display: flex;
                flex-wrap: wrap;
            }
            .flex-form,
            .flex-form * {
                font-size: 20px;
                color: purple;
            }
            .flex-form .group,
            .flex-form .field {
                box-sizing: border-box;
            }
            .flex-form .group {
                display: flex;
                flex-direction: column;
            }
            .flex-form > :nth-child(4n + 0) {
                border: solid 1px rgb(168, 168, 168);
                background: rgb(226, 226, 226);
            }
            .flex-form > :nth-child(4n + 1) {
                border: solid 1px rgb(129, 129, 129);
                background: rgb(209, 209, 209);
            }
            .flex-form > :nth-child(4n + 2) {
                border: solid 1px rgb(220, 202, 250);
                background: rgb(244, 236, 255);
            }
            .flex-form > :nth-child(4n + 3) {
                border: solid 1px rgb(208, 180, 252);
                background: rgb(232, 215, 252);
            }
            .flex-form .field {
                position: relative;
                min-width: 18em;
                max-width: 30em;
                padding: 0.3em 1em;
            }
            .flex-form > .group,
            .flex-form > .field {
                flex-grow: 1;
                flex-basis: 15em;
            }
            .flex-form .field label {
            }
            .flex-form .field em {
                width: 5.7em;
                padding: 0 0.4em;
                float: right;
                text-align: right;
            }
            .flex-form .field input:not([type="radio"]) {
                width: 5.7em;
                padding: 0 0.4em;
                float: right;
                border-radius: 0.4em;
                border: solid 0;
                background: transparent;
                box-shadow: 1px 1px 2px rgba(0, 0, 0, 0.2) inset, rgba(255, 255, 255, 0.7) 1px 1px 2px;
            }
            .flex-form .field fieldset :not(:first-of-type) {
                border-left: 1px solid #a56ac0;
            }
            .flex-form .field fieldset :first-of-type {
                padding-left: 0.4em;
            }
            .flex-form .field fieldset :last-of-type {
                padding-right: 0.4em;
            }
            .flex-form .field fieldset {
                padding: 0;
                overflow: hidden;
                border: 1px solid purple;
                background: rgb(201, 177, 212);
                border-radius: 1em;
                float: right;
                display: inline-flex; /*ignores whitespace*/
            }
            .flex-form .field fieldset label {
                padding: 0 0.2em;
                line-height: 1.7em;
                text-align: super;
                color: rgb(165, 106, 192);
            }
            .flex-form .field fieldset input {
                display: none;
            }
            .flex-form .field fieldset input:checked + label {
                background: rgb(165, 106, 192);
                text-shadow: rebeccapurple 1px 1px;
                color: rgb(240, 236, 241);
            }
            .flex-form .field abbr {
                position: absolute;
                right: 2.3em;
            }
            .flex-form .field.spacer {
                visibility: hidden;
            }
            .flex-form .command {
                display: flex;
                flex-wrap: wrap-reverse;
                justify-content: space-evenly;
                background: transparent;
                border: transparent;
            }
            .flex-form .command button,
            .flex-form .command a {
                flex-grow: 0;
                height: 1.8em;
            }
            .flex-form .field fieldset label[for="GreenTheme"],
            .flex-form .field fieldset label[for="RedTheme"],
            .flex-form .field fieldset label[for="ndTheme"] {
                min-width: 2em;
                color: rgba(0, 0, 0, 0);
                text-align: center;
            }
            .flex-form .field fieldset label[for="GreenTheme"] {
                background: #88c1a4;
            }
            .flex-form .field fieldset input:checked + label[for="GreenTheme"] {
                background: #00a650;
            }
            .flex-form .field fieldset label[for="RedTheme"] {
                background: #e5a8aa;
            }
            .flex-form .field fieldset input:checked + label[for="RedTheme"] {
                background: #e63138;
            }
            .flex-form .field fieldset label[for="GreenTheme"] {
                background: #88c1a4;
            }
            .flex-form .field fieldset input:checked + label[for="GreenTheme"] {
                background: #00a650;
            }
        </style>
        <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
    </head>
    <body>
        <main>
            <div class="flex-form">
                <div class="group">
                    <div class="field">
                        <label for="WidthTotal" title="Outer Width">Width</label><abbr>mm</abbr>
                        <input id="WidthTotal" type="number" value="140" min="40" max="400" title="Outer Width" />
                    </div>
                    <div class="field">
                        <label for="LengthTotal" title="Outer Length">Length</label><abbr>mm</abbr>
                        <input id="LengthTotal" type="number" value="229" min="40" max="600" title="Outer Length" />
                    </div>
                </div>
                <div class="group">
                    <div class="field">
                        <label title="Pouch can stand on end?">Gusset</label>
                        <fieldset>
                            <input id="IncludeGusset" name="Gusset" type="radio" value="true" title="Adds a gusset to the bottom of the pouch. Pouch can be stood up" data-show="#GussetDepthSection, #SidesWidthSection>em" data-vanish="#SidesWidthSection>input,#SidesWidthSection>abbr" />
                            <label for="IncludeGusset" title="Pouch can stand on end?">yes</label>
                            <input id="ExcludeGusset" name="Gusset" type="radio" value="false" checked title="No gusset on the pouch" data-hide="#GussetDepthSection" data-show="#SidesWidthSection>input,#SidesWidthSection>abbr" data-vanish="#SidesWidthSection>em" />
                            <label for="ExcludeGusset" title="Pouch can stand on end?">no</label>
                        </fieldset>
                    </div>
                    <div id="GussetDepthSection" class="field">
                        <label for="GussetDepth" title="Gusset overal size from front face to back face including seal">Size</label><abbr>mm</abbr>
                        <input id="GussetDepth" type="number" value="76" min="10" max="400" title="Gusset depth including seal" />
                    </div>
                </div>
                <div class="group">
                    <div class="field">
                        <label title="Include pouch sides?">Sides</label>
                        <fieldset>
                            <input id="IncludeSides" name="Sides" type="radio" value="true" title="Include left and right sides on the pouch?" data-show="#SidesWidthSection" />
                            <label for="IncludeSides" title="Adds a left and right side to the pouch">yes</label>
                            <input id="ExcludeSides" name="Sides" type="radio" value="false" checked title="No left and right sides on the pouch?" data-hide="#SidesWidthSection" />
                            <label for="ExcludeSides" title="No left and right side on the pouch">no</label>
                        </fieldset>
                    </div>
                    <div id="SidesWidthSection" class="field">
                        <label for="SideWidth" title="The width of each pouch side from the front of the pouch to the back">Width</label><abbr>mm</abbr>
                        <input id="SideWidth" type="number" value="70" min="40" max="600" title="The width of each pouch side" />
                        <em title="Side widths are matched to gusset size; change the gusset size or turn off gusset to adjust widths">see gusset</em>
                    </div>
                </div>
                <div class="group">
                    <div class="field">
                        <label title="How pouch will be sealed">Seal Placement</label>
                        <fieldset>
                            <input id="SealTop" name="SealPlacement" type="radio" value="Top" title="Top and sides will be sealed" />
                            <label for="SealTop" title="Apply a top seal?">top</label>
                            <input id="SealBottom" name="SealPlacement" type="radio" value="Bottom" checked title="Bottom and sides will be sealed" />
                            <label for="SealBottom" title="Apply a bottom seal?">bottom</label>
                        </fieldset>
                    </div>
                    <div class="field">
                        <label for="SealSize" title="The amount of edge material used for sealing the pouch">Seal Size</label>
                        <abbr>mm</abbr><input id="SealSize" type="number" value="7.5" min="5" step="0.1" title="The amount of edge material used for sealing the pouch" />
                    </div>
                </div>
                <div class="group">
                    <div class="field">
                        <label title="Include a zipper for reclosing the pouch?">Zipper</label>
                        <fieldset>
                            <input id="IncludeStandardZipper" name="Zipper" type="radio" value="Standard" title="Include a standard zipper for reclosing the pouch?" data-show="#ZipperOffsetSection" />
                            <label for="IncludeStandardZipper" title="Adds a standard zipper to the pouch">standard</label>
                            <input id="IncludeEasyPullZipper" name="Zipper" type="radio" value="EasyPull" title="Include an easy-pull zipper for reclosing the pouch?" data-show="#ZipperOffsetSection" />
                            <label for="IncludeEasyPullZipper" title="Adds an easy-pull zipper to the pouch">ez-pull</label>
                            <input id="IncludeChildResistantZipper" name="Zipper" type="radio" value="ChildResistant" title="Include a child-resistant zipper for reclosing the pouch?" data-show="#ZipperOffsetSection" />
                            <label for="IncludeChildResistantZipper" title="Adds a child-reistant zipper to the pouch">saftey</label>
                            <input id="ExcludeZipper" name="Zipper" type="radio" value="none" checked title="No zipper for reclosing the pouch?" data-hide="#ZipperOffsetSection" />
                            <label for="ExcludeZipper" title="No zipper on the pouch">none</label>
                        </fieldset>
                    </div>
                    <div id="ZipperOffsetSection" class="field">
                        <label for="ZipperOffset" title="The distance from the edge of the pouch to the top of the zipper">Zipper Offset</label><abbr>mm</abbr>
                        <input id="ZipperOffset" type="number" value="25" title="The distance from the edge of the pouch to the top of the zipper" />
                    </div>
                </div>
                <div class="group">
                    <div class="field">
                        <label for="" title="Include a tear notch for easy pouch opening?">Tear Notch</label>
                        <fieldset>
                            <input id="IncludeNotch" name="Notch" type="radio" value="true" title="Include a tear notch for easy pouch opening?" data-show="#NotchOffsetSection" />
                            <label for="IncludeNotch" title="Adds a tear notch to the pouch">yes</label>
                            <input id="ExcludeNotch" name="Notch" type="radio" value="false" checked title="No tear notch for easy opening of the pouch?" data-hide="#NotchOffsetSection" />
                            <label for="ExcludeNotch" title="No tear notch on the pouch">no</label>
                        </fieldset>
                    </div>
                    <div id="NotchOffsetSection" class="field">
                        <label for="NotchOffset" title="The distance from the edge of the pouch to the center of the tear notch">Notch Offset</label>
                        <abbr>mm</abbr>
                        <input id="NotchOffset" type="number" value="20" title="he distance from the edge of the pouch to the center of the tear notch" />
                    </div>
                </div>
                <div class="group">
                    <div class="field">
                        <label title="Include a hang hole for easy pouch opening?">Hang Hole</label>
                        <fieldset>
                            <input id="IncludeHole" name="Hole" type="radio" value="true" title="Include a hole for hanging the pouch?" data-show="#HoleOffsetSection" />
                            <label for="IncludeHole" title="Adds a hang hole to the pouch">yes</label>
                            <input id="ExcludeHole" name="Hole" type="radio" value="false" checked title="No hole for hanging the pouch?" data-hide="#HoleOffsetSection" />
                            <label for="ExcludeHole" title="No hang hole on the pouch">no</label>
                        </fieldset>
                    </div>
                    <div id="HoleOffsetSection" class="field">
                        <label for="HoleOffset" title="The distance from the edge of the pouch to the top of the hang hole">Hang Hole Offset</label><abbr>mm</abbr>
                        <input id="HoleOffset" type="number" value="8" min="6" max="40" title="The distance from the edge of the pouch to the top of the hang hole" />
                    </div>
                </div>
                <div class="group">
                    <div class="field">
                        <label title="Include a degasser valve?">Degas Valve</label>
                        <fieldset>
                            <input id="IncludeDegasser" name="Degasser" type="radio" value="true" title="Include a degasser valve?" data-show="#DegasserOffsetSection" />
                            <label for="IncludeDegasser" title="Adds a degasser valve to the pouch">yes</label>
                            <input id="ExcludeDegasser" name="Degasser" type="radio" value="false" checked title="No degasser valve?" data-hide="#DegasserOffsetSection" />
                            <label for="ExcludeDegasser" title="No degasser valve on the pouch">no</label>
                        </fieldset>
                    </div>
                    <div id="DegasserOffsetSection" class="field">
                        <label for="DegasserOffset" title="The distance from the edge of the pouch to the top of the hang hole">Degas Valve Offset</label><abbr>mm</abbr>
                        <input id="DegasserOffset" type="number" value="60" min="18" max="400" title="The distance from the edge of the pouch to the top of the degasser valve" />
                    </div>
                </div>
                <div class="group">
                    <div class="field">
                        <label title="Color theme?">Color Theme</label>
                        <fieldset>
                            <input id="GreenTheme" name="ColorTheme" type="radio" value="theme-green" checked title="Use a green theme?" />
                            <label for="GreenTheme" title="Applies a green theme">_</label>
                            <input id="RedTheme" name="ColorTheme" type="radio" value="theme-red" title="Use a red theme?" />
                            <label for="RedTheme" title="Applies a red theme">_</label>
                            <input id="ndTheme" name="ColorTheme" type="radio" value="theme-nd" title="Use a n/d theme?" />
                            <label for="ndTheme" title="Applies a n/d theme">N/D</label>
                        </fieldset>
                    </div>
                    <div class="field">
                        <label>&nbsp;</label>
                    </div>
                </div>
                <div class="group">
                    <div class="field">
                        <label title="Include inking details?">Inking Details</label>
                        <fieldset>
                            <input id="IncludeInkingDetails" name="InkingDetails" type="radio" value="true" title="Includes inking details?" />
                            <label for="IncludeInkingDetails" title="Adds inking details">yes</label>
                            <input id="ExcludeInkingDetails" name="InkingDetails" type="radio" value="false" checked title="No inking details?" />
                            <label for="ExcludeInkingDetails" title="No inking details">no</label>
                        </fieldset>
                    </div>
                    <div class="field">
                        <label>&nbsp;</label>
                    </div>
                </div>
                <div class="group">
                    <div class="field">
                        <label title="Include additional labels?">Labeling Verbosity</label>
                        <fieldset>
                            <input id="StandardLabelingVerbosity" name="LabelingVerbosity" type="radio" value="standard" checked title="No additional labels?" />
                            <label for="StandardLabelingVerbosity" title="No additional labels">standard</label>
                            <input id="DetailedLabelingVerbosity" name="LabelingVerbosity" type="radio" value="detailed" title="Include additional labels?" />
                            <label for="DetailedLabelingVerbosity" title="Additional Labels">detailed</label>
                        </fieldset>
                    </div>
                    <div class="field">
                        <label>&nbsp;</label>
                    </div>
                </div>
                <div class="field command">
                    <button id="Download" style="margin-top: 1em">Download</button>
                </div>
                <div class="spacer field">
                    <label></label>
                    <fieldset></fieldset>
                </div>
                <div class="spacer field">
                    <label></label>
                    <fieldset></fieldset>
                </div>
                <div class="spacer field">
                    <label></label>
                    <fieldset></fieldset>
                </div>
            </div>
        </main>
        <aside></aside>
        <script>
            class _Elements {
                _elements;
                constructor(domElements) {
                    this._elements = domElements;
                }
                get length() {
                    return this._elements.length;
                }
                create(elementName) {
                    var elements = [];
                    this._elements.forEach((el) => {
                        let newEl = document.createElementNS("http://www.w3.org/2000/svg", elementName);
                        el.appendChild(newEl);
                        elements.push(newEl);
                    });
                    return new _Elements(elements);
                }
                attr(name) {
                    return this._elements[0].getAttribute(name);
                }
                attr(name, value) {
                    this._elements.forEach((el) => {
                        el.setAttribute(name, value);
                    });
                    return this;
                }
                find(selector) {
                    return new _Elements($.makeArray($(this._elements).find(selector)));
                }
                text(innerText) {
                    $(this._elements).text(innerText);
                    return this;
                }
            }
            function _(selector) {
                return new _Elements($.makeArray($(selector)));
            }
        </script>
        <script type="module">
            import { PouchTemplate } from "./js/templates/PouchTemplate.js";
            import { Placement } from "./js/enums/Placement.js";
            import { ZipperType } from "./js/enums/ZipperType.js";

            let pouch = PouchTemplate.getDefault(UpdateSvg);
            let themeClass = "theme-green";
            let verboseLabels = false;
            let inkingDetails = true;
            let svgNotchLarge = "m4.5 0 0-9-4.5-5.5-4.5 5.5 0 9z";
            let svgArrowLarge = "m0 0c2.57 10.57 3.37 12.44 4.29 14.75l-8.77 0c.39-.83 1.73-4.18 2.59-7.05.93-3.08 1.57-5.87 1.79-7.68";
            let svgArrowSmall = "m0 0c-1.7 6.86-2.22 8.07-2.82 9.56h5.67c-.25-.53-1.11-2.7-1.68-4.62-.6-1.99-1.04-3.79-1.16-4.97";

            //radio event binding
            $("[data-show]").on("change", function (ev) {
                let $t = $(ev.target).filter(":checked");
                if ($t.length) showByData($t.data("show"));
            });
            $("[data-hide]").on("change", function (ev) {
                //hidden is visibility:hidden;
                let $t = $(ev.target).filter(":checked");
                if ($t.length) hideByData($t.data("hide"));
            });
            $("[data-vanish]").on("change", function (ev) {
                //vanished is display:none;
                let $t = $(ev.target).filter(":checked");
                if ($t.length) vanishByData($t.data("vanish"));
            });

            function ensureShown() {
                $("[data-show]:checked").each((i, el) => {
                    showByData($(el).data("show"));
                });
            }
            function ensureHidden() {
                $("[data-hide]:checked").each((i, el) => {
                    hideByData($(el).data("hide"));
                });
            }
            function ensureVanished() {
                $("[data-vanish]:checked").each((i, el) => {
                    vanishByData($(el).data("vanish"));
                });
            }

            function showByData(selector) {
                $(selector).css("visibility", "").css("display", "");
                ensureHidden();
                ensureVanished();
            }
            function hideByData(selector) {
                $(selector).css("visibility", "hidden");
            }
            function vanishByData(selector) {
                $(selector).css("display", "none");
            }

            //initialize show/hide based on current checks (show before hide i.e. (show + show == show, show + hide == hide, hide + hide == hide))
            ensureShown();

            //--load svg--//
            console.log(pouch); //TODO: remove;
            CreateSvg();
            UpdateSvg(); //update once after creating

            //--bindings--//
            $("#WidthTotal").on("change", function (ev) {
                pouch.front.width.value = ev.target.value * 1;
            });
            $("#LengthTotal").on("change", function (ev) {
                pouch.front.height.value = ev.target.value * 1;
            });
            $("#IncludeGusset").on("change", function (ev) {
                pouch.gusset.included = ev.target.checked;
                if (ev.target.checked) {
                    $("[for=SealTop]")
                        .css("text-decoration", "line-through 2px #777")
                        .on("click", function () {
                            alert("Cannot place a top seal when a gusset is included");
                            return false;
                        });
                    $("#SealBottom").click();
                }
            });
            $("#ExcludeGusset").on("change", function (ev) {
                pouch.gusset.included = !ev.target.checked;
                if (ev.target.checked) {
                    $("[for=SealTop]").css("text-decoration", "").off("click");
                }
            });
            if ($("#IncludeGusset")[0].checked) {
                //toggle initial state back and forth to ensure that events and styles are added.
                $("#ExcludeGusset").click();
                $("#IncludeGusset").click();
            }
            $("#GussetDepth").on("change", function (ev) {
                pouch.gusset.depth.value = ev.target.value * 1;
            });
            $("#IncludeSides").on("change", function (ev) {
                pouch.left.included = ev.target.checked;
            });
            $("#ExcludeSides").on("change", function (ev) {
                pouch.right.included = !ev.target.checked;
            });
            $("#SealSize").on("change", function (ev) {
                pouch.seal.width.value = ev.target.value * 1;
            });
            $("#SealTop").on("change", function (ev) {
                pouch.seal.placement = ev.target.checked ? Placement.Top : Placement.Bottom;
            });
            $("#SealBottom").on("change", function (ev) {
                pouch.seal.placement = ev.target.checked ? Placement.Bottom : Placement.Top;
            });
            $("#IncludeStandardZipper").on("change", function (ev) {
                pouch.zipper.included = ev.target.checked;
                pouch.zipper.type = ZipperType.Standard;
            });
            $("#IncludeEasyPullZipper").on("change", function (ev) {
                pouch.zipper.included = ev.target.checked;
                pouch.zipper.type = ZipperType.EasyPull;
            });
            $("#IncludeChildResistantZipper").on("change", function (ev) {
                pouch.zipper.included = ev.target.checked;
                pouch.zipper.type = ZipperType.ChildResistant;
            });
            $("#ExcludeZipper").on("change", function (ev) {
                pouch.zipper.included = !ev.target.checked;
            });
            $("#ZipperOffset").on("change", function (ev) {
                pouch.zipper.offset.value = ev.target.value * 1;
            });
            $("#IncludeNotch").on("change", function (ev) {
                pouch.notch.included = ev.target.checked;
            });
            $("#ExcludeNotch").on("change", function (ev) {
                pouch.notch.included = !ev.target.checked;
            });
            $("#NotchOffset").on("change", function (ev) {
                pouch.notch.offset.value = ev.target.value * 1;
            });
            $("#IncludeHole").on("change", function (ev) {
                pouch.hanger.included = ev.target.checked;
            });
            $("#ExcludeHole").on("change", function (ev) {
                pouch.hanger.included = !ev.target.checked;
            });
            $("#HoleOffset").on("change", function (ev) {
                pouch.hanger.offset.value = ev.target.value * 1;
            });
            $("#IncludeDegasser").on("change", function (ev) {
                pouch.degasser.included = ev.target.checked;
            });
            $("#ExcludeDegasser").on("change", function (ev) {
                pouch.degasser.included = !ev.target.checked;
            });
            $("#DegasserOffset").on("change", function (ev) {
                pouch.degasser.offset.value = ev.target.value * 1;
            });
            $("#IncludeInkingDetails").on("change", function (ev) {
                inkingDetails = ev.target.checked;
            });
            $("#ExcludeInkingDetails").on("change", function (ev) {
                inkingDetails = !ev.target.checked;
            });
            $("#StandardLabelingVerbosity").on("change", function (ev) {
                verboseLabels = !ev.target.checked;
            });
            $("#DetailedLabelingVerbosity").on("change", function (ev) {
                verboseLabels = ev.target.checked;
            });

            //--periodic model updating--//
            let w = $("#WidthTotal")[0],
                h = $("#LengthTotal")[0],
                yesGusset = $("#IncludeGusset")[0],
                gusset = $("#GussetDepth")[0],
                yesSides = $("#IncludeSides")[0],
                sides = $("#SideWidth")[0],
                seal = $("#SealSize")[0],
                sealPlacement = $("#SealBottom")[0],
                noZipper = $("#ExcludeZipper")[0],
                zipperType = $("[name=Zipper]"),
                zipperOffset = $("#ZipperOffset")[0],
                yesNotch = $("#IncludeNotch")[0],
                notch = $("#NotchOffset")[0],
                yesHanger = $("#IncludeHole")[0],
                hanger = $("#HoleOffset")[0],
                yesDegasser = $("#IncludeDegasser")[0],
                degasser = $("#DegasserOffset")[0],
                theme = $("[name=ColorTheme]"),
                yesInkingDetails = $("#IncludeInkingDetails")[0],
                yesVerboseLabels = $("#DetailedLabelingVerbosity")[0];

            (function UpdateModel() {
                let otherSvgChange = false;
                pouch.front.width.value = w.value * 1;
                pouch.front.height.value = h.value * 1;
                pouch.gusset.included = yesGusset.checked;
                pouch.gusset.depth.value = gusset.value * 1;
                pouch.left.included = yesSides.checked;
                pouch.left.width.value = yesGusset.checked ? gusset.value * 1 : sides.value * 1; // width is from gusset if the gusset is on
                pouch.seal.width.value = seal.value * 1;
                pouch.seal.placement = sealPlacement.checked ? Placement.Bottom : Placement.Top;
                pouch.zipper.included = !noZipper.checked;
                pouch.zipper.type = pouch.zipper.included ? ZipperType[zipperType.not(":not(:checked)")[0].value] : pouch.zipper.type;
                pouch.zipper.offset.value = zipperOffset.value * 1;
                pouch.notch.included = yesNotch.checked;
                pouch.notch.offset.value = notch.value * 1;
                pouch.hanger.included = yesHanger.checked;
                pouch.hanger.offset.value = hanger.value * 1;
                pouch.degasser.included = yesDegasser.checked;
                pouch.degasser.offset.value = degasser.value * 1;
                let old = themeClass;
                themeClass = theme.not(":not(:checked)")[0].value;
                if (themeClass != old) otherSvgChange = true;
                old = inkingDetails;
                inkingDetails = yesInkingDetails.checked;
                if (inkingDetails != old) otherSvgChange = true;
                old = verboseLabels;
                verboseLabels = yesVerboseLabels.checked;
                if (verboseLabels != old) otherSvgChange = true;
                setTimeout(UpdateModel, 100);
                if (otherSvgChange) UpdateSvg(); //a change not tracked by the pouch object
            })();

            //--create svg--//
            function CreateSvg() {
                let _svg = _("aside").create("svg");
                $.get("svg.css", function (text) {
                    _svg.create("style").text(text);
                });
                let _front = _svg.create("svg").attr("class", "side front").attr("overflow", "visible");

                //header label//
                let _header = _front.create("g").attr("class", "header");
                _header.create("rect").attr("class", "label background fill dark face");
                _header.create("text").attr("class", "label left fill light medium").text("FRONT");
                _header.create("text").attr("class", "label center fill light medium").text("(OPENING)");
                _header.create("text").attr("class", "label right fill light medium").text("TOP");

                //face//
                let _face = _front.create("g").attr("class", "face");
                _face.create("rect").attr("class", "outline continuous large");

                //face height guides//
                let _outerHeight = _face.create("g").attr("class", "height outer");
                _outerHeight.create("text").attr("class", "fill dark medium").attr("transform", "rotate(-90)");
                _outerHeight.create("line").attr("class", "mark top continuous medium");
                _outerHeight.create("svg").attr("class", "arrow top").attr("overflow", "visible").create("path").attr("d", svgArrowLarge).attr("class", "fill");
                _outerHeight.create("line").attr("class", "arrow continuous medium");
                _outerHeight.create("svg").attr("class", "arrow bottom").attr("overflow", "visible").create("path").attr("d", svgArrowLarge).attr("class", "fill").attr("transform", "rotate(180)");
                _outerHeight.create("line").attr("class", "mark bottom continuous medium");

                //face width guides//
                let _outerWidth = _face.create("g").attr("class", "width outer");
                _outerWidth.create("text").attr("class", "fill dark medium");
                _outerWidth.create("line").attr("class", "mark left continuous medium");
                _outerWidth.create("svg").attr("class", "arrow left").attr("overflow", "visible").create("path").attr("d", svgArrowLarge).attr("class", "fill").attr("transform", "rotate(-90)");
                _outerWidth.create("line").attr("class", "arrow continuous medium");
                _outerWidth.create("svg").attr("class", "arrow right").attr("overflow", "visible").create("path").attr("d", svgArrowLarge).attr("class", "fill").attr("transform", "rotate(90)");
                _outerWidth.create("line").attr("class", "mark right continuous medium");

                //hanger//
                let _hanger = _front.create("g").attr("class", "hanger");
                _hanger.create("circle").attr("class", "hole fill dark");
                let _hangerOffset = _hanger.create("g").attr("class", "offset");
                _hangerOffset.create("text").attr("class", "fill dark small");
                _hangerOffset.create("svg").attr("class", "arrow top").attr("overflow", "visible").create("path").attr("d", svgArrowSmall).attr("class", "fill");
                _hangerOffset.create("line").attr("class", "arrow continuous medium");
                _hangerOffset.create("svg").attr("class", "arrow bottom").attr("overflow", "visible").create("path").attr("d", svgArrowSmall).attr("class", "fill").attr("transform", "rotate(180)");
                _hangerOffset.create("line").attr("class", "mark bottom continuous medium");

                //notch//
                let _notch = _front.create("g").attr("class", "notch");
                _notch.create("svg").attr("class", "cut left fill dark").attr("overflow", "visible").create("path").attr("d", svgNotchLarge).attr("class", "fill").attr("transform", "rotate(90)");
                _notch.create("svg").attr("class", "cut right fill dark").attr("overflow", "visible").create("path").attr("d", svgNotchLarge).attr("class", "fill").attr("transform", "rotate(-90)");
                let _notchOffset = _notch.create("g").attr("class", "offset");
                _notchOffset.create("text").attr("class", "fill dark small").attr("transform", "rotate(90)");
                _notchOffset.create("line").attr("class", "mark top continuous medium");
                _notchOffset.create("svg").attr("class", "arrow top").attr("overflow", "visible").create("path").attr("d", svgArrowSmall).attr("class", "fill");
                _notchOffset.create("line").attr("class", "arrow continuous medium");
                _notchOffset.create("svg").attr("class", "arrow bottom").attr("overflow", "visible").create("path").attr("d", svgArrowSmall).attr("class", "fill").attr("transform", "rotate(180)");
                _notchOffset.create("line").attr("class", "mark bottom continuous medium");

                //zippers//
                let _zipper = _front.create("g").attr("class", "zipper");
                let _straight = _zipper.create("g").attr("class", "straight");
                _straight.create("rect").attr("class", "outline continuous small");
                _straight.create("rect").attr("class", "inner dashed small");
                let _wishbone = _zipper.create("g").attr("class", "wishbone");
                _wishbone.create("clipPath").attr("id", "WishboneUpperTopClip").create("rect").attr("class", "clip top").attr("width", "7.3mm").attr("height", "4mm");
                _wishbone.create("clipPath").attr("id", "WishboneMiddleClip").create("rect").attr("class", "clip middle").attr("width", "2.5mm").attr("height", "10.5mm");
                _wishbone.create("clipPath").attr("id", "WishboneLowerBottomClip").create("rect").attr("class", "clip bottom").attr("width", "7.3mm").attr("height", "4mm");
                _wishbone.create("circle").attr("class", "tear upper top dashed small").attr("clip-path", "url(#WishboneUpperTopClip)").attr("r", "3.5mm");
                _wishbone.create("circle").attr("class", "tear upper bottom dashed small").attr("clip-path", "url(#WishboneMiddleClip)").attr("r", "3mm");
                _wishbone.create("circle").attr("class", "tear lower top dashed small").attr("clip-path", "url(#WishboneMiddleClip)").attr("r", "3mm");
                _wishbone.create("circle").attr("class", "tear lower bottom dashed small").attr("clip-path", "url(#WishboneLowerBottomClip)").attr("r", "3.5mm");
                let _heatedClip = _wishbone.create("clipPath").attr("id", "HeatedClip");
                _heatedClip.create("rect").attr("class", "clip heated").attr("width", "50mm").attr("x", "0mm").attr("y", "0mm");
                _wishbone.create("rect").attr("class", "heated vertical dotted large").attr("clip-path", "url(#HeatedClip)").attr("rx", "2mm");
                _wishbone.create("line").attr("class", "heated horizontal dotted large");
                _wishbone.create("rect").attr("class", "outline continuous small");
                _wishbone.create("rect").attr("class", "inner dashed small");
                let _zipperOffset = _zipper.create("g").attr("class", "offset");
                _zipperOffset.create("text").attr("class", "fill dark small").attr("transform", "rotate(90)");
                _zipperOffset.create("line").attr("class", "mark top continuous medium");
                _zipperOffset.create("svg").attr("class", "arrow top").attr("overflow", "visible").create("path").attr("d", svgArrowSmall).attr("class", "fill");
                _zipperOffset.create("line").attr("class", "arrow continuous medium");
                _zipperOffset.create("svg").attr("class", "arrow bottom").attr("overflow", "visible").create("path").attr("d", svgArrowSmall).attr("class", "fill").attr("transform", "rotate(180)");
                _zipperOffset.create("line").attr("class", "mark bottom continuous medium");

                //degasser//
                let _degasser = _front.create("g").attr("class", "degasser");
                _degasser.create("circle").attr("class", "outer dotted large");
                _degasser.create("circle").attr("class", "inner continuous small");
                let _degasserOffset = _degasser.create("g").attr("class", "offset");
                _degasserOffset.create("text").attr("class", "fill dark small").attr("transform", "rotate(-90)");
                _degasserOffset.create("line").attr("class", "mark top continuous medium");
                _degasserOffset.create("svg").attr("class", "arrow top").attr("overflow", "visible").create("path").attr("d", svgArrowSmall).attr("class", "fill");
                _degasserOffset.create("line").attr("class", "arrow continuous medium");
                _degasserOffset.create("svg").attr("class", "arrow bottom").attr("overflow", "visible").create("path").attr("d", svgArrowSmall).attr("class", "fill").attr("transform", "rotate(180)");
                _degasserOffset.create("line").attr("class", "mark bottom continuous medium");

                //seal//
                let _seal = _front.create("g").attr("class", "seal");
                _seal.create("rect").attr("class", "outline dashed medium");
                // let curveClipId = "_" + ("0000" + Math.random().toString(36).replace(".", "")).substr(-5);
                _seal.create("clipPath").attr("id", "CurveClip").create("rect").attr("class", "clip");
                _seal.create("ellipse").attr("class", "curve dashed medium").attr("clip-path", "url(#CurveClip)");

                //meridian//
                let _meridian = _front.create("g").attr("class", "meridian");
                _meridian.create("line").attr("class", "divide dashed medium");
                let _meridianOffset = _meridian.create("g").attr("class", "offset");
                _meridianOffset.create("text").attr("class", "fill dark small").attr("transform", "rotate(90)");
                _meridianOffset.create("line").attr("class", "mark top continuous medium");
                _meridianOffset.create("svg").attr("class", "arrow top").attr("overflow", "visible").create("path").attr("d", svgArrowSmall).attr("class", "fill");
                _meridianOffset.create("line").attr("class", "arrow continuous medium");
                _meridianOffset.create("svg").attr("class", "arrow bottom").attr("overflow", "visible").create("path").attr("d", svgArrowSmall).attr("class", "fill").attr("transform", "rotate(180)");
                _meridianOffset.create("line").attr("class", "mark bottom continuous medium");
            }

            //--adjust svg--//
            function UpdateSvg() {
                let $svg = $("aside>svg");
                if ($svg.length) {
                    let horizSpace = 40;
                    let vertSpace = 40;
                    let width = pouch.right.included ? pouch.front.width.value * 2 + pouch.right.width.value * 2 + horizSpace * 5 : pouch.front.width.value * 2 + horizSpace * 3;
                    let height = pouch.gusset.included ? pouch.front.height.value + pouch.gusset.depth.value + vertSpace * 3 : pouch.front.height.value + vertSpace * 2;
                    $svg.attr("class", themeClass)
                        .attr("width", width + "mm")
                        .attr("height", height + "mm");
                    //UpdateSvgViewBox($svg, horizSpace);
                    UpdateSvgFront($svg, horizSpace, vertSpace);
                    UpdateSvgBack($svg, horizSpace);
                    UpdateSvgRight($svg, horizSpace);
                    UpdateSvgLeft($svg, horizSpace);
                    UpdateSvgGusset($svg, vertSpace);
                }
            }
            // function UpdateSvgViewBox($svg, horizSpace, ratio) {
            //     let gussetDepth = pouch.gusset.included ? 183 + pouch.gusset.depth.value * ratio : 0; //header and space + gusset
            //     let frontBackWidth = (pouch.front.width.value + pouch.back.width.value) * ratio + 380;
            //     let leftRightWidth = pouch.left.included && pouch.right.included ? (pouch.right.width.value + pouch.left.width.value) * ratio + 380 : 0;
            //     $svg.attr("viewBox", `${450 - pouch.front.width.value * ratio} ${175} ${frontBackWidth + leftRightWidth} ${170 + pouch.front.height.value * ratio + gussetDepth}`);
            // }
            function UpdateSvgFront($svg, horizSpace, vertSpace) {
                //NOTE: The following variables unit is mm!
                let __center = pouch.front.width.value / 2;
                let __middle = pouch.front.height.value / 2;

                let _front = _("aside > svg .side.front");
                let _face = _front.find(".face");

                //conditional elements//
                if (pouch.zipper.included) $(".side.front .zipper").show();
                else $(".side.front .zipper").hide();
                if (pouch.notch.included) $(".side.front .notch").show();
                else $(".side.front .notch").hide();
                if (pouch.zipper.type == ZipperType.EasyPull) {
                    $(".side.front .zipper .wishbone").show();
                    $(".side.front .zipper .straight").hide();
                } else {
                    $(".side.front .zipper .wishbone").hide();
                    $(".side.front .zipper .straight").show();
                }
                if (pouch.hanger.included) $(".side.front .hanger").show();
                else $(".side.front .hanger").hide();
                if (pouch.degasser.included) $(".side.front .degasser").show();
                else $(".side.front .degasser").hide();
                if (pouch.left.included) $(".side.front .seal .curve, .side.front .meridian").hide();
                else $(".side.front .seal .curve, .side.front .meridian").show();

                ////////////////////TODO: seal labels
                if (pouch.hanger.included && pouch.seal.placement == Placement.Top) $("#Front .bottom.seal.size.text").hide();
                //hides label if hanger is in the way
                else $("#Front .bottom.seal.size.text").show();

                //front//
                _front.attr("x", horizSpace + "mm").attr("y", vertSpace + "mm");

                //header label//
                let _header = _front.find(".header");
                let headerMargin = 17;
                _header
                    .find(".label.background")
                    .attr("x", -headerMargin + "mm")
                    .attr("y", -25 + "mm")
                    .attr("width", pouch.front.width.value + headerMargin * 2 + "mm")
                    .attr("height", 7 + "mm");
                _header
                    .find(".label.left")
                    .attr("x", -headerMargin + 4 + "mm")
                    .attr("y", -19 + "mm");
                if (pouch.seal.placement == Placement.Top) {
                    _header
                        .find(".label.center")
                        .attr("x", __center - 15 + "mm")
                        .attr("y", -19 + "mm")
                        .text("(SEALED TOP)");
                } else if (pouch.seal.placement == Placement.Bottom) {
                    _header
                        .find(".label.center")
                        .attr("x", __center - 13 + "mm")
                        .attr("y", -19 + "mm")
                        .text("(OPENING)");
                } else throw "unexpected placement location";
                _header
                    .find(".label.right")
                    .attr("x", pouch.front.width.value + headerMargin - 18 + "mm")
                    .attr("y", -19 + "mm");

                //face//
                _face
                    .find(".outline")
                    .attr("x", 0 + "mm")
                    .attr("y", 0 + "mm")
                    .attr("width", pouch.front.width.value + "mm")
                    .attr("height", pouch.front.height.value + "mm");

                //face height guides//
                let _outerHeight = _face.find(".height.outer");
                _outerHeight
                    .find("text")
                    .attr("y", -7 + "mm")
                    .attr("x", -(__middle + 7) + "mm")
                    .text(pouch.front.height.value + " mm");
                _outerHeight
                    .find(".mark.top")
                    .attr("x1", -6 + "mm")
                    .attr("x2", -1 + "mm")
                    .attr("y1", 0 + "mm")
                    .attr("y2", 0 + "mm");
                _outerHeight
                    .find(".arrow.top")
                    .attr("x", -3 + "mm")
                    .attr("y", 0 + "mm");
                _outerHeight
                    .find("line.arrow")
                    .attr("x1", -3 + "mm")
                    .attr("x2", -3 + "mm")
                    .attr("y1", 2 + "mm")
                    .attr("y2", pouch.front.height.value - 2 + "mm");
                _outerHeight
                    .find(".arrow.bottom")
                    .attr("x", -3 + "mm")
                    .attr("y", pouch.front.height.value + "mm");
                _outerHeight
                    .find(".mark.bottom")
                    .attr("x1", -6 + "mm")
                    .attr("x2", -1 + "mm")
                    .attr("y1", pouch.front.height.value + "mm")
                    .attr("y2", pouch.front.height.value + "mm");

                //face width guides//
                let _outerWidth = _face.find(".width.outer");
                _outerWidth
                    .find("text")
                    .attr("x", __center - 7 + "mm")
                    .attr("y", -7 + "mm")
                    .text(pouch.front.width.value + " mm");
                _outerWidth
                    .find(".mark.left")
                    .attr("x1", 0 + "mm")
                    .attr("x2", 0 + "mm")
                    .attr("y1", -6 + "mm")
                    .attr("y2", -1 + "mm");
                _outerWidth
                    .find(".arrow.left")
                    .attr("x", 0 + "mm")
                    .attr("y", -3 + "mm");
                _outerWidth
                    .find("line.arrow")
                    .attr("x1", 2 + "mm")
                    .attr("x2", pouch.front.width.value - 2 + "mm")
                    .attr("y1", -3 + "mm")
                    .attr("y2", -3 + "mm");
                _outerWidth
                    .find(".arrow.right")
                    .attr("x", pouch.front.width.value + "mm")
                    .attr("y", -3 + "mm");
                _outerWidth
                    .find(".mark.right")
                    .attr("x1", pouch.front.width.value + "mm")
                    .attr("x2", pouch.front.width.value + "mm")
                    .attr("y1", -6 + "mm")
                    .attr("y2", -1 + "mm");

                //hanger//
                let _hanger = _front.find(".hanger");
                _hanger
                    .find(".hole")
                    .attr("cx", __center + "mm")
                    .attr("cy", pouch.hanger.offset.value + "mm")
                    .attr("r", pouch.hanger.height.value / 2 + "mm");
                let _hangerOffset = _hanger.find(".offset");
                _hangerOffset
                    .find("text")
                    .attr("x", __center + pouch.hanger.height.value / 2 + 5.5 + "mm")
                    .attr("y", pouch.hanger.offset.value / 2 + 1 + "mm")
                    .text(pouch.hanger.offset.value + " mm");
                _hangerOffset
                    .find(".arrow.top")
                    .attr("x", __center + pouch.hanger.height.value / 2 + 3 + "mm")
                    .attr("y", 0 + "mm");
                _hangerOffset
                    .find("line.arrow")
                    .attr("x1", __center + pouch.hanger.height.value / 2 + 3 + "mm")
                    .attr("x2", __center + pouch.hanger.height.value / 2 + 3 + "mm")
                    .attr("y1", 2 + "mm")
                    .attr("y2", pouch.hanger.offset.value - 2 + "mm");
                _hangerOffset
                    .find(".arrow.bottom")
                    .attr("x", __center + pouch.hanger.height.value / 2 + 3 + "mm")
                    .attr("y", pouch.hanger.offset.value + "mm");
                _hangerOffset
                    .find(".mark.bottom")
                    .attr("x1", __center + pouch.hanger.height.value / 2 + 1 + "mm")
                    .attr("x2", __center + pouch.hanger.height.value / 2 + 6 + "mm")
                    .attr("y1", pouch.hanger.offset.value + "mm")
                    .attr("y2", pouch.hanger.offset.value + "mm");

                //notch//
                let _notch = _front.find(".notch");
                _notch
                    .find(".cut.left")
                    .attr("x", 0 + "mm")
                    .attr("y", pouch.notch.offset.value + "mm");
                _notch
                    .find(".cut.right")
                    .attr("x", pouch.front.width.value + "mm")
                    .attr("y", pouch.notch.offset.value + "mm");
                let _notchOffset = _notch.find(".offset");
                _notchOffset
                    .find("text")
                    .attr("y", -pouch.front.width.value - 5 + "mm")
                    .attr("x", pouch.notch.offset.value / 2 - 5.5 + "mm")
                    .text(pouch.notch.offset.value + " mm");
                _notchOffset
                    .find(".mark.top")
                    .attr("x1", pouch.front.width.value + 1 + "mm")
                    .attr("x2", pouch.front.width.value + 6 + "mm")
                    .attr("y1", 0 + "mm")
                    .attr("y2", 0 + "mm");
                _notchOffset
                    .find(".arrow.top")
                    .attr("x", pouch.front.width.value + 3 + "mm")
                    .attr("y", 0 + "mm");
                _notchOffset
                    .find("line.arrow")
                    .attr("x1", pouch.front.width.value + 3 + "mm")
                    .attr("x2", pouch.front.width.value + 3 + "mm")
                    .attr("y1", 2 + "mm")
                    .attr("y2", pouch.notch.offset.value - 2 + "mm");
                _notchOffset
                    .find(".arrow.bottom")
                    .attr("x", pouch.front.width.value + 3 + "mm")
                    .attr("y", pouch.notch.offset.value + "mm");
                _notchOffset
                    .find(".mark.bottom")
                    .attr("x1", pouch.front.width.value + 1 + "mm")
                    .attr("x2", pouch.front.width.value + 6 + "mm")
                    .attr("y1", pouch.notch.offset.value + "mm")
                    .attr("y2", pouch.notch.offset.value + "mm");

                //zippers//
                let _zipper = _front.find(".zipper");
                let _straight = _zipper.find(".straight");
                _straight
                    .find(".outline")
                    .attr("x", 0 + "mm")
                    .attr("y", pouch.zipper.offset.value - pouch.zipper.height.value / 2 + "mm")
                    .attr("width", pouch.front.width.value + "mm")
                    .attr("height", pouch.zipper.height.value + "mm");
                _straight
                    .find(".inner")
                    .attr("x", 0 + "mm")
                    .attr("y", pouch.zipper.offset.value - pouch.zipper.height.value / 6 + "mm")
                    .attr("width", pouch.front.width.value + "mm")
                    .attr("height", pouch.zipper.height.value / 3 + "mm");
                let _wishbone = _zipper.find(".wishbone");
                let wishboneX = 3;
                _wishbone
                    .find(".clip.top")
                    .attr("x", wishboneX - 0.2 + "mm")
                    .attr("y", pouch.zipper.offset.value - 14.5 + "mm");
                _wishbone
                    .find(".clip.middle")
                    .attr("x", wishboneX + 6.85 + "mm")
                    .attr("y", pouch.zipper.offset.value - 9.5 + "mm");
                _wishbone
                    .find(".clip.bottom")
                    .attr("x", wishboneX - 0.2 + "mm")
                    .attr("y", pouch.zipper.offset.value + 2.5 + "mm");
                _wishbone
                    .find(".tear.upper.top")
                    .attr("cx", wishboneX + 3.5 + "mm")
                    .attr("cy", pouch.zipper.offset.value - 10.5 + "mm");
                _wishbone
                    .find(".tear.upper.bottom")
                    .attr("cx", wishboneX + 10 + "mm")
                    .attr("cy", pouch.zipper.offset.value - 9.5 + "mm");
                _wishbone
                    .find(".tear.lower.top")
                    .attr("cx", wishboneX + 10 + "mm")
                    .attr("cy", pouch.zipper.offset.value + 1 + "mm");
                _wishbone
                    .find(".tear.lower.bottom")
                    .attr("cx", wishboneX + 3.5 + "mm")
                    .attr("cy", pouch.zipper.offset.value + 2.5 + "mm");
                _wishbone.find(".clip.heated").attr("height", pouch.zipper.offset.value + 40 + "mm");
                _wishbone
                    .find(".heated.vertical")
                    .attr("x", -10 + "mm")
                    .attr("y", -10 + "mm")
                    .attr("width", 25.5 + "mm")
                    .attr("height", pouch.zipper.offset.value + 41.5 + "mm");
                _wishbone
                    .find(".heated.horizontal")
                    .attr("x1", 0 + "mm")
                    .attr("x2", pouch.front.width.value + "mm")
                    .attr("y1", pouch.zipper.offset.value + 17.5 + "mm")
                    .attr("y2", pouch.zipper.offset.value + 17.5 + "mm");
                _wishbone
                    .find(".outline")
                    .attr("x", 3 + "mm")
                    .attr("y", pouch.zipper.offset.value - pouch.zipper.height.value / 2 + "mm")
                    .attr("width", pouch.front.width.value - 3 + "mm")
                    .attr("height", pouch.zipper.height.value + "mm");
                _wishbone
                    .find(".inner")
                    .attr("x", 3 + "mm")
                    .attr("y", pouch.zipper.offset.value - pouch.zipper.height.value / 6 + "mm")
                    .attr("width", pouch.front.width.value - 3 + "mm")
                    .attr("height", pouch.zipper.height.value / 3 + "mm");
                let _zipperOffset = _zipper.find(".offset");
                _zipperOffset
                    .find("text")
                    .attr("y", -pouch.front.width.value - 11 + "mm")
                    .attr("x", pouch.zipper.offset.value / 2 - 5.5 + "mm")
                    .text(pouch.zipper.offset.value + " mm");
                _zipperOffset
                    .find(".mark.top")
                    .attr("x1", pouch.front.width.value + 1 + "mm")
                    .attr("x2", pouch.front.width.value + 12 + "mm")
                    .attr("y1", 0 + "mm")
                    .attr("y2", 0 + "mm");
                _zipperOffset
                    .find(".arrow.top")
                    .attr("x", pouch.front.width.value + 9 + "mm")
                    .attr("y", 0 + "mm");
                _zipperOffset
                    .find("line.arrow")
                    .attr("x1", pouch.front.width.value + 9 + "mm")
                    .attr("x2", pouch.front.width.value + 9 + "mm")
                    .attr("y1", 2 + "mm")
                    .attr("y2", pouch.zipper.offset.value - 2 + "mm");
                _zipperOffset
                    .find(".arrow.bottom")
                    .attr("x", pouch.front.width.value + 9 + "mm")
                    .attr("y", pouch.zipper.offset.value + "mm");
                _zipperOffset
                    .find(".mark.bottom")
                    .attr("x1", pouch.front.width.value + 1 + "mm")
                    .attr("x2", pouch.front.width.value + 12 + "mm")
                    .attr("y1", pouch.zipper.offset.value + "mm")
                    .attr("y2", pouch.zipper.offset.value + "mm");

                //degasser//
                let _degasser = _front.find(".degasser");
                _degasser
                    .find("circle.outer")
                    .attr("cx", __center + "mm")
                    .attr("cy", pouch.degasser.offset.value + "mm")
                    .attr("r", pouch.degasser.height.value / 2 + "mm");
                _degasser
                    .find("circle.inner")
                    .attr("cx", __center + "mm")
                    .attr("cy", pouch.degasser.offset.value + "mm")
                    .attr("r", 1.5 + "mm");
                let _degasserOffset = _degasser.find(".offset");
                _degasserOffset
                    .find("text")
                    .attr("y", __center - 6 + "mm")
                    .attr("x", -(pouch.degasser.offset.value * 0.95 - 5.5) + "mm")
                    .text(pouch.degasser.offset.value + " mm");
                _degasserOffset
                    .find(".mark.top")
                    .attr("x1", __center - 2.5 + "mm")
                    .attr("x2", __center - 7.5 + "mm")
                    .attr("y1", 0 + "mm")
                    .attr("y2", 0 + "mm");
                _degasserOffset
                    .find(".arrow.top")
                    .attr("x", __center - 4.5 + "mm")
                    .attr("y", 0 + "mm");
                _degasserOffset
                    .find("line.arrow")
                    .attr("x1", __center - 4.5 + "mm")
                    .attr("x2", __center - 4.5 + "mm")
                    .attr("y1", 2 + "mm")
                    .attr("y2", pouch.degasser.offset.value - 2 + "mm");
                _degasserOffset
                    .find(".arrow.bottom")
                    .attr("x", __center - 4.5 + "mm")
                    .attr("y", 0 + pouch.degasser.offset.value + "mm");
                _degasserOffset
                    .find(".mark.bottom")
                    .attr("x1", __center - 2.5 + "mm")
                    .attr("x2", __center - 7.5 + "mm")
                    .attr("y1", 0 + pouch.degasser.offset.value + "mm")
                    .attr("y2", 0 + pouch.degasser.offset.value + "mm");

                //seal//
                let _seal = _front.find(".seal");
                if (pouch.seal.placement == Placement.Bottom) {
                    _seal
                        .find(".outline")
                        .attr("x", pouch.seal.width.value + "mm")
                        .attr("y", 0 + "mm")
                        .attr("width", pouch.front.width.value - pouch.seal.width.value * 2 + "mm")
                        .attr("height", pouch.front.height.value - pouch.seal.width.value + "mm");
                } else if (pouch.seal.placement == Placement.Top) {
                    _seal
                        .find(".outline")
                        .attr("x", pouch.seal.width.value + "mm")
                        .attr("y", pouch.seal.width.value + "mm")
                        .attr("width", pouch.front.width.value - pouch.seal.width.value * 2 + "mm")
                        .attr("height", pouch.front.height.value - pouch.seal.width.value + "mm");
                } else throw "Placement type is not implemented, type: " + pouch.seal.placement;
                _seal
                    .find(".curve")
                    .attr("cx", __center + "mm")
                    .attr("cy", pouch.front.height.value - pouch.gusset.depth.value / 2 + "mm")
                    .attr("rx", pouch.front.width.value / 2 - pouch.seal.width.value + "mm")
                    .attr("ry", pouch.gusset.depth.value / 2 - pouch.seal.width.value + "mm");
                _seal
                    .find(".clip")
                    .attr("x", 0 + "mm")
                    .attr("y", pouch.front.height.value - pouch.gusset.depth.value / 2 + "mm")
                    .attr("width", pouch.front.width.value + "mm")
                    .attr("height", pouch.gusset.depth.value / 2 + "mm");

                //meridian//
                let _meridian = _front.find(".meridian");
                _meridian
                    .find(".divide")
                    .attr("x1", 0 + "mm")
                    .attr("x2", pouch.front.width.value + "mm")
                    .attr("y1", pouch.front.height.value - pouch.gusset.depth.value / 2 + "mm")
                    .attr("y2", pouch.front.height.value - pouch.gusset.depth.value / 2 + "mm");
                let _meridianOffset = _meridian.find(".offset");
                _meridianOffset
                    .find("text")
                    .attr("y", -(pouch.front.width.value + 5) + "mm")
                    .attr("x", pouch.front.height.value - pouch.gusset.depth.value / 4 - 5.5 + "mm")
                    .text(pouch.gusset.depth.value / 2 + " mm");
                _meridianOffset
                    .find(".mark.top")
                    .attr("x1", pouch.front.width.value + 1 + "mm")
                    .attr("x2", pouch.front.width.value + 6 + "mm")
                    .attr("y1", pouch.front.height.value - pouch.gusset.depth.value / 2 + "mm")
                    .attr("y2", pouch.front.height.value - pouch.gusset.depth.value / 2 + "mm");
                _meridianOffset
                    .find(".arrow.top")
                    .attr("x", pouch.front.width.value + 3 + "mm")
                    .attr("y", pouch.front.height.value - pouch.gusset.depth.value / 2 + "mm");
                _meridianOffset
                    .find("line.arrow")
                    .attr("x1", pouch.front.width.value + 3 + "mm")
                    .attr("x2", pouch.front.width.value + 3 + "mm")
                    .attr("y1", pouch.front.height.value - pouch.gusset.depth.value / 2 + 2 + "mm")
                    .attr("y2", pouch.front.height.value - 2 + "mm");
                _meridianOffset
                    .find(".arrow.bottom")
                    .attr("x", pouch.front.width.value + 3 + "mm")
                    .attr("y", pouch.front.height.value + "mm");
                _meridianOffset
                    .find(".mark.bottom")
                    .attr("x1", pouch.front.width.value + 1 + "mm")
                    .attr("x2", pouch.front.width.value + 6 + "mm")
                    .attr("y1", pouch.front.height.value + "mm")
                    .attr("y2", pouch.front.height.value + "mm");
            }
            // function CreateHorizontalBezierArc(x1, x2, y, radius) {
            //     return `M ${x1} ${y} C ${x1} ${y + radius * 1.32536445942915653}, ${x2} ${y + radius * 1.32536445942915653}, ${x2} ${y}`;
            // }
            function UpdateSvgBack($svg, horizSpace) {
                let __left = pouch.right.included ? horizSpace * 3 + pouch.front.width.value + pouch.right.width.value : horizSpace * 2 + pouch.front.width.value;
                let __$svg = $("aside > svg");
                let $front = __$svg.find(".side.front");
                let $old = __$svg.find(".side.back");
                let $new = $front.clone();
                $new.toggleClass("front back");
                $new.find(".header .label.left").text("BACK");
                $new.find(".zipper").remove();
                $new.find(".degasser").remove();
                $new.attr("x", __left + "mm");
                $old.remove();
                $new.appendTo(__$svg);
            }
            function UpdateSvgLeft($svg, horizSpace) {
                let __left = horizSpace * 4 + pouch.front.width.value * 2 + pouch.right.width.value;
                let __$svg = $("aside > svg");
                let $front = __$svg.find(".side.right");
                let $old = __$svg.find(".side.left");
                if (pouch.left.included) {
                    let $new = $front.clone();
                    $new.toggleClass("right left");
                    $new.find(".header .label.left").text("LEFT");
                    $new.find(".header .label.center").text("");
                    $new.attr("x", __left + "mm");
                    $new.appendTo(__$svg);
                }
                $old.remove();
            }
            function UpdateSvgRight($svg, horizSpace) {
                let __left = horizSpace * 2 + pouch.front.width.value;
                let __$svg = $("aside > svg");
                let $front = __$svg.find(".side.front");
                let $old = __$svg.find(".side.right");
                if (pouch.left.included) {
                    let $new = $front.clone();
                    $new.toggleClass("front right");

                    //header label//
                    let headerMargin = 17;
                    $new.find(".header .label.background").attr("width", pouch.right.width.value + headerMargin * 2 + "mm");
                    $new.find(".header .label.left").text("RIGHT");
                    $new.find(".header .label.center").remove();
                    $new.find(".header .label.right").attr("x", pouch.right.width.value + headerMargin - 18 + "mm");

                    //face//
                    $new.find(".face .outline").attr("width", pouch.left.width.value + "mm");

                    //face width guides//
                    $new.find(".face .width.outer text")
                        .attr("x", pouch.right.width.value / 2 - 7 + "mm")
                        .text(pouch.right.width.value + " mm");
                    $new.find(".face .width.outer line.arrow").attr("x2", pouch.right.width.value - 2 + "mm");
                    $new.find(".face .width.outer .arrow.right").attr("x", pouch.right.width.value + "mm");
                    $new.find(".face .width.outer .mark.right")
                        .attr("x1", pouch.right.width.value + "mm")
                        .attr("x2", pouch.right.width.value + "mm");

                    //seal//
                    $new.find(".seal .outline").attr("width", pouch.right.width.value - pouch.seal.width.value * 2 + "mm");

                    $new.find(".hanger").remove();
                    $new.find(".notch").remove();
                    $new.find(".zipper").remove();
                    $new.find(".degasser").remove();
                    $new.attr("x", __left + "mm");
                    $new.appendTo(__$svg);
                }
                $old.remove();
            }
            function UpdateSvgGusset($svg, vertSpace) {
                let __top = pouch.front.height.value + vertSpace * 2;
                let __$svg = $("aside > svg");
                let $front = __$svg.find(".side.front");
                let $old = __$svg.find(".side.gusset");
                if (pouch.gusset.included) {
                    let $new = $front.clone();
                    $new.toggleClass("front gusset");

                    //header label//
                    let headerMargin = 17;
                    $new.find(".header .label.background"); //.attr("width", pouch.right.width.value + headerMargin * 2 + "mm");
                    $new.find(".header .label.left").text("BOTTOM");
                    $new.find(".header .label.center").remove();
                    $new.find(".header .label.right")
                        .attr("x", pouch.front.width.value + headerMargin - 33 + "mm")
                        .text("GUSSET");

                    //face//
                    $new.find(".face .outline").attr("height", pouch.gusset.depth.value + "mm");

                    //face width guides//
                    $new.find(".face .width.outer").remove();

                    //face height guides//
                    $new.find(".face .height.outer text")
                        .attr("x", -(pouch.gusset.depth.value / 2 + 7) + "mm")
                        .text(pouch.gusset.depth.value + " mm");
                    $new.find(".face .height.outer line.arrow").attr("y2", pouch.gusset.depth.value - 2 + "mm");
                    $new.find(".face .height.outer .arrow.bottom").attr("y", pouch.gusset.depth.value + "mm");
                    $new.find(".face .height.outer .mark.bottom")
                        .attr("y1", pouch.gusset.depth.value + "mm")
                        .attr("y2", pouch.gusset.depth.value + "mm");

                    //seal//
                    $new.find(".seal .curve")
                        .attr("cy", pouch.gusset.depth.value / 2 + "mm")
                        .attr("clip-path", "");
                    $new.find(".seal .outline")
                        .attr("y", pouch.seal.width.value + "mm")
                        .attr("height", pouch.gusset.depth.value - pouch.seal.width.value * 2 + "mm");

                    //meridian//
                    $new.find(".meridian .divide")
                        .attr("y1", pouch.gusset.depth.value / 2 + "mm")
                        .attr("y2", pouch.gusset.depth.value / 2 + "mm");
                    $new.find(".meridian .offset text")
                        .attr("y", -(pouch.front.width.value + 5) + "mm")
                        .attr("x", pouch.gusset.depth.value / 4 - 4 + "mm")
                        .text(pouch.gusset.depth.value / 2 + " mm");
                    $new.find(".meridian .offset .mark.top")
                        .attr("y1", pouch.gusset.depth.value / 2 + "mm")
                        .attr("y2", pouch.gusset.depth.value / 2 + "mm");
                    $new.find(".meridian .offset .arrow.top").attr("y", 0 + "mm");
                    $new.find(".meridian .offset line.arrow")
                        .attr("y1", 2 + "mm")
                        .attr("y2", pouch.gusset.depth.value / 2 - 2 + "mm");
                    $new.find(".meridian .offset .arrow.bottom").attr("y", pouch.gusset.depth.value / 2 + "mm");
                    $new.find(".meridian .offset .mark.bottom")
                        .attr("y1", 0 + "mm")
                        .attr("y2", 0 + "mm");

                    $new.find(".hanger").remove();
                    $new.find(".notch").remove();
                    $new.find(".zipper").remove();
                    $new.find(".degasser").remove();
                    $new.attr("y", __top + "mm");
                    $new.appendTo(__$svg);
                }
                $old.remove();
            }
        </script>

        <script id="Downloader">
            function downloadSvg(filename, svgElement) {
                var el = document.createElement("a");
                el.setAttribute("href", "data:image/svg+xml;charset=utf-8," + encodeURIComponent(svgElement.outerHTML));
                el.setAttribute("download", filename);
                el.style.display = "none";
                document.body.appendChild(el);
                el.click();
                document.body.removeChild(el);
            }

            $("#Download").on("click", function () {
                downloadSvg("pouch-dieline.svg", $("aside>svg")[0]);
            });
        </script>
    </body>
</html>
